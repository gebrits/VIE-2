<!DOCTYPE html>  <html> <head>   <title>core.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="dbpedia.html">                 dbpedia.js               </a>                                           <a class="source" href="rdfa.html">                 rdfa.js               </a>                                           <a class="source" href="stanbol.html">                 stanbol.js               </a>                                           <a class="source" href="connector.html">                 connector.js               </a>                                           <a class="source" href="core.html">                 core.js               </a>                                           <a class="source" href="mapping.html">                 mapping.js               </a>                                           <a class="source" href="util.html">                 util.js               </a>                                           <a class="source" href="person.html">                 person.js               </a>                                           <a class="source" href="place.html">                 place.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               core.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="c">/**</span>
<span class="c"> * @fileOverview VIE^2</span>
<span class="c"> * @author &lt;a href=&quot;mailto:sebastian.germesin@dfki.de&quot;&gt;Sebastian Germesin&lt;/a&gt;</span>
<span class="c"> */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>VIE^2 is the semantic enrichment layer on top of VIE. 
Through it you can query and find related content 
for your editables. VIE^2 can talk to services like 
Apache Stanbol and OpenCalais to find related 
information for your content.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="o">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>VIE^2 is implmented as a <a href="http://semantic-interaction.org/blog/2011/03/01/jquery-ui-widget-factory/">jQuery UI widget</a>. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s1">&#39;VIE2.vie2&#39;</span><span class="o">,</span> <span class="p">{</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>default options</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">options</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><strong>namespaces</strong>: There are currently some default namespaces given, which
can be overwritten and/or extended using the .vie2('option', ...) method.</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">namespaces</span><span class="o">:</span> <span class="p">{</span>
				<span class="s1">&#39;vie2&#39;</span> <span class="o">:</span> <span class="s1">&#39;http://vie2/property/&#39;</span>
			<span class="p">}</span><span class="o">,</span>
	    	</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p><strong>_globalContext</strong>: The private _globalContext object stores all triples that
were retrieved so far. The values are <pre>rdfQuery objects</pre>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	    	<span class="nx">_globalContext</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">()</span><span class="o">,</span>
	    	</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><strong>_localContext</strong>: The private _localContext object stores all triples that
were retrieved so far for each element. The keys are the id of the element and
the values are <pre>rdfQuery objects</pre>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	    	<span class="nx">_localContext</span><span class="o">:</span> <span class="p">{}</span>
    	<span class="p">}</span><span class="o">,</span>
    	
    	<span class="nx">_create</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    		<span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">();</span>
    		
    		</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>automatically scans for xmlns attributes in the html element
and adds them to the local this.options.namespaces object</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">).</span><span class="nx">xmlns</span><span class="p">()</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    		<span class="p">});</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>scan for connector-specific namespaces</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">()[</span><span class="s1">&#39;namespaces&#39;</span><span class="p">])</span> <span class="p">{</span>
	    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">()[</span><span class="s1">&#39;namespaces&#39;</span><span class="p">]</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
	    				<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="o">;</span>
	    			<span class="p">});</span>
	    		<span class="p">}</span>
    		<span class="p">});</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>add all namespaces to the local cache at this.options._globalContext</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="k">this</span><span class="p">.</span><span class="nx">_initNamespaces</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span><span class="p">);</span>
    	<span class="p">}</span><span class="o">,</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>extends needs to be used as the default implementation would overwrite the namespaces</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">_setOption</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="o">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    		<span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">===</span> <span class="s1">&#39;namespaces&#39;</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span> <span class="p">(</span><span class="kc">true</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="nx">value</span><span class="p">);</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    				<span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span>
				<span class="p">});</span>
    		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setOption</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="p">[</span><span class="nx">key</span><span class="o">,</span> <span class="nx">value</span><span class="p">]);</span>
    		<span class="p">}</span>
    	<span class="p">}</span><span class="o">,</span>
    	
    	<span class="nx">_initNamespaces</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rdf</span><span class="p">)</span> <span class="p">{</span>
    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">rdf</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span>
			<span class="p">});</span>
    	<span class="p">}</span><span class="o">,</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><strong>analyze()</strong>: The <code><pre>analyze(elem, callback)</pre></code> function is used to
analyze the given element <strong>elem</strong> with all connectors and - once finished - executes
<strong>callback(elem)</strong>.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">analyze</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="o">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="nx">elem</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;No element specified, returning without action!&quot;</span><span class="p">);</span>
				<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>
				<span class="k">return</span><span class="o">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;No callback specified, returning without action!&quot;</span><span class="p">);</span>
				<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>
				<span class="k">return</span><span class="o">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">))</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;No element id specified, generate one dynamically and add it!&quot;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">tempId</span> <span class="o">=</span> <span class="nx">PseudoGuid</span><span class="p">.</span><span class="nx">GetNew</span><span class="p">();</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Generated id: &#39;&quot;</span> <span class="o">+</span> <span class="nx">tempId</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
				<span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="o">,</span> <span class="nx">tempId</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start.&quot;</span><span class="p">);</span>
			</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>init element context</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_localContext</span><span class="p">[</span><span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">rdf</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">()</span><span class="o">,</span>
					<span class="nx">elem</span><span class="o">:</span> <span class="nx">elem</span>
			<span class="p">};</span>
			<span class="nx">that</span><span class="p">.</span><span class="nx">_initNamespaces</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_localContext</span><span class="p">[</span><span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)][</span><span class="s1">&#39;rdf&#39;</span><span class="p">]);</span>
			</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>as the connectors work asynchronously, we need a queue to listen if all connectors are finished.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">connectorQueue</span> <span class="o">=</span> <span class="p">[];</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>fill queue of connectors with 'id's to have an overview of running connectors.
this supports the asynchronous calls.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
			<span class="p">});</span>
			
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">connectorCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vie2</span><span class="o">,</span> <span class="nx">conn</span><span class="o">,</span> <span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rdf</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Received RDF annotation from connector &#39;&quot;</span> <span class="o">+</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
						<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">rdf</span><span class="p">);</span>
						</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>we add all namespaces to the rdfQuery object. 
Attention: this might override namespaces that were added by the connector!
but keeps consistency through the VIE^2.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nx">that</span><span class="p">.</span><span class="nx">_initNamespaces</span><span class="p">(</span><span class="nx">rdf</span><span class="p">);</span>
						
						<span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>add all triples to the global cache!</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nx">vie2</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>fill element-specific context</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_localContext</span><span class="p">[</span><span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)][</span><span class="s1">&#39;rdf&#39;</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
						<span class="p">});</span>
						</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>add all subjects to the corresponding backbone collection(s)</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">subjectIndex</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
							<span class="kd">var</span> <span class="nx">types</span> <span class="o">=</span> <span class="p">[];</span>
							</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>an entity of id 'subject' can only be added once to a backbone JS collection
hence, we need to collect all types of that entity first in an array.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nx">rdf</span>
							<span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">subject</span> <span class="o">+</span> <span class="s1">&#39; a ?type&#39;</span><span class="p">)</span>
							<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
								<span class="kd">var</span> <span class="nx">curie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">value</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span> <span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
								<span class="nx">types</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">curie</span><span class="p">);</span>
							<span class="p">});</span>
							<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">addBBEntity</span><span class="p">({</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">subject</span><span class="o">,</span> <span class="nx">a</span> <span class="o">:</span> <span class="nx">types</span><span class="p">});</span>
						<span class="p">});</span>
						
						<span class="nx">removeElement</span><span class="p">(</span><span class="nx">connectorQueue</span><span class="o">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>everytime we receive annotations from each connector, we remove the connector's id from the
queue and check whether the queue is empty.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">if</span> <span class="p">(</span><span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>if the queue is empty, all connectors have successfully returned and we can execute the
callback function.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished! Cache holds now &quot;</span> <span class="o">+</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>provide a status field in the callback object: status = {'ok', 'error'};</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">elem</span><span class="o">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">);</span>
						<span class="p">}</span>
					<span class="p">};</span>
				<span class="p">}(</span><span class="nx">that</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="nx">elem</span><span class="p">);</span>
				</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>start analysis with the connector.</p>             </td>             <td class="code">               <div class="highlight"><pre> 				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Starting analysis with connector: &#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">analyze</span><span class="p">(</span><span class="nx">elem</span><span class="o">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="nx">connectorCallback</span><span class="p">);</span>
			<span class="p">});</span>
		<span class="p">}</span><span class="o">,</span>
		</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><strong>annotate(triples, elem)</strong>: Supports the (manual) annotation of the element <strong>elem</strong>
with the (semantic) data, stored in <strong>triple</strong>.
<strong>triple</strong> needs to be a <i>String</i> or an array of <i>String</i>.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">annotate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">triples</span><span class="o">,</span> <span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="nx">elem</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">))</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;No element id specified, generate one dynamically and add it!&quot;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">tempId</span> <span class="o">=</span> <span class="nx">PseudoGuid</span><span class="p">.</span><span class="nx">GetNew</span><span class="p">();</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;Generated id: &#39;&quot;</span> <span class="o">+</span> <span class="nx">tempId</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
				<span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="o">,</span> <span class="nx">tempId</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">triples</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;No triple specified, returning without action!&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
			<span class="p">}</span>
			</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>allocate temporary rdfQuery object</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">rdf</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">({</span><span class="nx">namespaces</span> <span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">triples</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">annotate</span><span class="p">([</span><span class="nx">triples</span><span class="p">]</span><span class="o">,</span> <span class="nx">elem</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">triples</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">triple</span> <span class="o">=</span> <span class="nx">triples</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
					<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">triple</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">triple</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="nx">triple</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>TODO?</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="p">}</span>
					<span class="nx">rdf</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">triple</span><span class="p">);</span>					
				<span class="p">});</span>
			<span class="p">}</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start.&quot;</span><span class="p">);</span>
			</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>(1) put it into that.options._globalContext</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
			<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>(2) put it into that.options._localContext</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="nx">elem</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_localContext</span><span class="p">[</span><span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)])</span> <span class="p">{</span>
					<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_localContext</span><span class="p">[</span><span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
							<span class="nx">rdf</span><span class="o">:</span> <span class="nx">rdf</span><span class="o">,</span>
							<span class="nx">elem</span><span class="o">:</span> <span class="nx">elem</span>
					<span class="p">};</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
						<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_localContext</span><span class="p">[</span><span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)][</span><span class="s1">&#39;rdf&#39;</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
					<span class="p">});</span>
				<span class="p">}</span>
			<span class="p">}</span>
			</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>(3) look for backbone model(s) and update their attributes.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">subjectIndex</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">triples</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">triples</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">triple</span> <span class="o">=</span> <span class="nx">triples</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
					<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
						<span class="kd">var</span> <span class="nx">ent</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>

						<span class="k">if</span> <span class="p">(</span><span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>only update the backbone entity if the property is a
default property!</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="kd">var</span> <span class="nx">curie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="nx">triple</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
							<span class="k">if</span> <span class="p">(</span><span class="nx">ent</span><span class="p">.</span><span class="nx">defaults</span><span class="p">[</span><span class="nx">curie</span><span class="p">])</span> <span class="p">{</span>
								<span class="nx">ent</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span>
								<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;Added value to entity &#39;&quot;</span> <span class="o">+</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; &#39;&quot;</span> <span class="o">+</span> <span class="nx">curie</span> <span class="o">+</span> <span class="s2">&quot;&#39; &#39;&quot;</span> <span class="o">+</span> <span class="nx">triple</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
							<span class="p">}</span>
						<span class="p">}</span>
					<span class="p">});</span>
				<span class="p">});</span>
			<span class="p">});</span>
			</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>(4) register new entity/ies as backbone model(s)
this needs to be done <em>after</em> the properties have been loaded into
the cache, as 'addBBEntity() already performs a query for the entities'
properties.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">subjectIndex</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">types</span> <span class="o">=</span> <span class="p">[];</span>
				</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>an entity of id 'id' can only be added once to a backbone JS collection
hence, we need to collect all types of that entity first in an array.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">rdf</span>
				<span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">subject</span> <span class="o">+</span> <span class="s1">&#39; a ?type&#39;</span><span class="p">)</span>
				<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">curie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">value</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span> <span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
					<span class="nx">types</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">curie</span><span class="p">);</span>
				<span class="p">});</span>
				
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">addBBEntity</span><span class="p">({</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">subject</span><span class="o">,</span> <span class="nx">a</span> <span class="o">:</span> <span class="nx">types</span><span class="p">});</span>
			<span class="p">});</span>

			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;End.&quot;</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;Global cache holds now &quot;</span> <span class="o">+</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">elem</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;Local cache of element &#39;&quot;</span> <span class="o">+</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; holds now &quot;</span> <span class="o">+</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_localContext</span><span class="p">[</span><span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)][</span><span class="s1">&#39;rdf&#39;</span><span class="p">].</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
		<span class="p">}</span><span class="o">,</span>
		</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p><strong>query</strong>: The query function supports querying for properties. The uri needs
to be of type <code>jQuery.rdf</code> object or a simple string and the property is either an array of strings
or a simple string. The function iterates over all connectors that have <code>query()</code>
implemented and collects data in an object.
The callback retrieves an object with the properties as keys and an array of results as their corresponding values.
The <i>options</i> is an object that supports the following keys:
options.cache : {'nocache', 'cacheonly'} -> nocache: do not use the cache but query for data online
-> cacheonly: query offline only</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">query</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">props</span><span class="o">,</span> <span class="nx">callback</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start!&quot;</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="nx">uri</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">props</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Invoked &#39;query()&#39; with undefined argument(s)!&quot;</span><span class="p">);</span>
				<span class="nx">callback</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
				<span class="k">return</span><span class="o">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">props</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="p">[</span><span class="nx">props</span><span class="p">]</span><span class="o">,</span> <span class="nx">callback</span><span class="o">,</span> <span class="nx">options</span><span class="p">);</span>
				<span class="k">return</span><span class="o">;</span>
			<span class="p">}</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">uri</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">props</span><span class="p">))</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>initialize the returning object</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">ret</span><span class="p">[</span><span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[];</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>look up for properties in options._globalContext
first check if we should ignore the cache!</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span> <span class="o">||</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">cache</span> <span class="o">===</span> <span class="s1">&#39;nocache&#39;</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span>
						<span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">pattern</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="s1">&#39;?object&#39;</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">}))</span>
						<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
							<span class="nx">ret</span><span class="p">[</span><span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span>
						<span class="p">});</span>
					<span class="p">}</span>
				<span class="p">}</span>
				</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>finish here if said so!</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">cache</span> <span class="o">===</span> <span class="s1">&#39;cacheonly&#39;</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">callback</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
					<span class="k">return</span><span class="o">;</span>
				<span class="p">}</span>
				
				<span class="kd">var</span> <span class="nx">connectorQueue</span> <span class="o">=</span> <span class="p">[];</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>fill queue of connectors with 'id's to have an overview of running connectors.
this supports the asynchronous calls.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
				<span class="p">});</span>
				</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>look up for properties in the connectors that
implement/overwrite the query() method</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start with connector &#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; for uri &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
					<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vie</span><span class="o">,</span> <span class="nx">conn</span><span class="o">,</span> <span class="nx">uri</span><span class="o">,</span> <span class="nx">namespaces</span><span class="o">,</span> <span class="nx">ret</span><span class="o">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
							<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Received query information from connector &#39;&quot;</span> <span class="o">+</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; for uri &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
							<span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="o">,</span> <span class="nx">ret</span><span class="o">,</span> <span class="nx">data</span><span class="p">);</span>
							
							<span class="nx">removeElement</span><span class="p">(</span><span class="nx">connectorQueue</span><span class="o">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
							<span class="k">if</span> <span class="p">(</span><span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>if the queue is empty, all connectors have successfully returned and we can call the
callback function.</p>             </td>             <td class="code">               <div class="highlight"><pre>								</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>adding new information to cache!</p>             </td>             <td class="code">               <div class="highlight"><pre>								<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">ret</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
									<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
										<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">namespaces</span><span class="p">}));</span>
									<span class="p">}</span>
								<span class="p">});</span>
								<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished task: &#39;query()&#39; for uri &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;! Cache holds now &quot;</span> <span class="o">+</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">tripleStore</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
								<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
							<span class="p">}</span>
						<span class="p">};</span>
					<span class="p">}(</span><span class="nx">that</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="nx">uri</span><span class="o">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="nx">ret</span><span class="o">,</span> <span class="nx">callback</span><span class="p">);</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">props</span><span class="o">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="nx">c</span><span class="p">);</span>
				<span class="p">});</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">callback</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span><span class="o">,</span>
		
		<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>get data from global storage!</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
			<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
			<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span>
			<span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">pattern</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">prop</span><span class="o">,</span> <span class="s1">&#39;?object&#39;</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">}))</span>
			<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span>
			<span class="p">});</span>
			
			<span class="k">return</span> <span class="nx">ret</span><span class="o">;</span>
		<span class="p">}</span><span class="o">,</span>
		</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><strong>clear</strong>: Clears the local context and the cache.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">clear</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_localConext</span> <span class="o">=</span> <span class="p">{};</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">_globalContext</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">();</span>
			<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
		<span class="p">}</span>
		
	<span class="p">});</span>
<span class="p">}(</span><span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p><strong>$.VIE2.log</strong>: Static convenience method for logging.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">level</span><span class="o">,</span> <span class="nx">component</span><span class="o">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">switch</span> <span class="p">(</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">case</span> <span class="s2">&quot;info&quot;</span><span class="o">:</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">component</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
		<span class="k">break</span><span class="o">;</span>
	<span class="nx">case</span> <span class="s2">&quot;warn&quot;</span><span class="o">:</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">component</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
		<span class="k">break</span><span class="o">;</span>
	<span class="nx">case</span> <span class="s2">&quot;error&quot;</span><span class="o">:</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">component</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
		<span class="k">break</span><span class="o">;</span>
	<span class="p">}</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Backbone JS Models / Collections</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Entity</span> <span class="o">=</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">RDFEntity</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
	
	<span class="nx">lookup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">props</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">lookup</span><span class="p">([</span><span class="nx">props</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>query connectors for properties</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">VIE2</span><span class="p">.</span><span class="nx">vie2</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">props</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">entity</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span>
				<span class="p">};</span>
			<span class="p">}(</span><span class="k">this</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span><span class="o">,</span>
	
	<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">vie2</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attr</span><span class="p">);</span>
	<span class="p">}</span><span class="o">,</span>
	
	<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>TODO: call VIE2.annotate(this.id, attrs);!</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
	<span class="p">}</span>

<span class="p">});</span>

<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">addBBEntity</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">belongsHere</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">ans</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span> <span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span> <span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">belongsHere</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
				<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
			<span class="p">}</span>
		<span class="p">});</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">belongsHere</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">tmpModel</span> <span class="o">=</span> <span class="nx">e</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">model</span><span class="o">;</span>
			<span class="kd">var</span> <span class="nx">bbModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">tmpModel</span><span class="p">(</span><span class="nx">entity</span><span class="p">);</span>
			<span class="nx">e</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">bbModel</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#addBBEntity()&quot;</span><span class="o">,</span> <span class="s2">&quot;Added entity &#39;&quot;</span> <span class="o">+</span> <span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; to collection of type &#39;&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">mapping</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>query for default properties to make them available in the offline storage</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">VIE2</span><span class="p">.</span><span class="nx">vie2</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="o">,</span> <span class="nx">bbModel</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">defaultProps</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">bbModel</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">bbModel</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span>
				<span class="p">};</span>
			<span class="p">}(</span><span class="nx">bbModel</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p><strong>$.VIE2.connectors</strong>: Static array of all registered connectors.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p><strong>$.VIE2.registerConnector</strong>: Static method to register a connector (is automatically called 
during construction of connector class.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">registerConnector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">connector</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>first check if there is already 
a connector with 'connector.id' registered</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="p">[</span><span class="nx">connector</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="p">[</span><span class="nx">connector</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">connector</span><span class="o">;</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerConnector()&quot;</span><span class="o">,</span> <span class="s2">&quot;Registered connector &#39;&quot;</span> <span class="o">+</span> <span class="nx">connector</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
		
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerConnector()&quot;</span><span class="o">,</span> <span class="s2">&quot;Did not register connector, as there is&quot;</span> <span class="o">+</span>
				<span class="s2">&quot;already a connector with the same id registered.&quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p><strong>$.VIE2.unregisterConnector</strong>: Unregistering of connectors. There is currently
no usecase for that, but it wasn't that hard to implement it ;)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">unregisterConnector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">connectorId</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="p">[</span><span class="nx">connector</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="o">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p><strong>$.VIE2.mappings</strong>: Static object of all registered mappings.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p><strong>$.VIE2.registerMapping</strong>: Static method to register a mapping (is automatically called 
during construction of mapping class.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">registerMapping</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mapping</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>first check if there is already 
a mapping with 'mapping.id' registered    </p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span><span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerMapping()&quot;</span><span class="o">,</span> <span class="s2">&quot;Registered mapping &#39;&quot;</span> <span class="o">+</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span><span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">mapping</span><span class="o">;</span>
		</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>backboneJS mapping        </p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">props</span> <span class="o">=</span> <span class="p">{};</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">defaultProps</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">props</span><span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">defaultProps</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="p">});</span>
		<span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Entity</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">defaults</span><span class="o">:</span> <span class="nx">props</span><span class="p">});</span>
		<span class="kd">var</span> <span class="nx">Collection</span> <span class="o">=</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">RDFEntityCollection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">Model</span><span class="p">});</span>
		
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s2">&quot;a&quot;</span> <span class="o">:</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">types</span><span class="p">))</span><span class="o">?</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">types</span> <span class="o">:</span> <span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">types</span><span class="p">]</span><span class="o">,</span>
				<span class="s2">&quot;collection&quot;</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">()</span>
		<span class="p">};</span>
		
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerMapping()&quot;</span><span class="o">,</span> <span class="s2">&quot;Registered mapping &#39;&quot;</span> <span class="o">+</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; finished!&quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerMapping()&quot;</span><span class="o">,</span> <span class="s2">&quot;Did not register mapping, as there is&quot;</span> <span class="o">+</span>
				<span class="s2">&quot;already a mapping with the same id registered.&quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p><strong>$.VIE2.unregisterMapping</strong>: Unregistering of mappings. There is currently
no usecase for that, but it wasn't that hard to implement it ;)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">unregisterMapping</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mappingId</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span><span class="p">[</span><span class="nx">mappingId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="o">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>init</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">VIE2</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">vie2</span><span class="p">();</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2 is fully instantiated and ready!&quot;</span><span class="p">);</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 