<!DOCTYPE html>  <html> <head>   <title>core.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="dbpedia.html">                 dbpedia.js               </a>                                           <a class="source" href="rdfa.html">                 rdfa.js               </a>                                           <a class="source" href="stanbol.html">                 stanbol.js               </a>                                           <a class="source" href="connector.html">                 connector.js               </a>                                           <a class="source" href="core.html">                 core.js               </a>                                           <a class="source" href="mapping.html">                 mapping.js               </a>                                           <a class="source" href="util.html">                 util.js               </a>                                           <a class="source" href="person.html">                 person.js               </a>                                           <a class="source" href="place.html">                 place.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               core.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="c">/**</span>
<span class="c"> * @fileOverview VIE^2</span>
<span class="c"> * @author &lt;a href=&quot;mailto:sebastian.germesin@dfki.de&quot;&gt;Sebastian Germesin&lt;/a&gt;</span>
<span class="c"> */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>VIE^2 is the semantic enrichment layer on top of VIE.
Its acronym stands for <b>V</b>ienna <b>I</b>KS <b>E</b>ntities <b>E</b>ditable.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>With the help of VIE^2, you can bring entites in your
content (aka. semantic lifting) and furthermore interact
with this knowledge in a MVC manner - using Backbone JS models
and collections.
VIE^2 has two main principles: </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <ul>
<li>Connectors:
Connecting VIE^2 with <strong>backend</strong> services, that
can either analyse and enrich the content sent to them (e.g., using
Apache Stanbol or Zemanta), can act as knowledge databases (e.g., DBPedia)
or as serializer (e.g., RDFa).</li>
<li>Mappings:
In a mapping, a web developer can specify a mapping from ontological entities
to backbone JS models. The developer can easily add types of enties and
also default attributes that are automatically filled with the help of the 
available connectors.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="o">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>VIE^2 is implmented as a <a href="http://semantic-interaction.org/blog/2011/03/01/jquery-ui-widget-factory/">jQuery UI widget</a>. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s1">&#39;VIE2.vie2&#39;</span><span class="o">,</span> <span class="p">{</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>default options</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><strong>localContext</strong>: The variable <strong>localContext</strong> stores element-specific triples
that were retrieved so far for the corresponding element in an <em>rdfQuery object</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">localContext</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">()</span>
    	<span class="p">}</span><span class="o">,</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><strong><em>create()</strong>: The private method <strong></em>create():</strong> is called implicitly when
calling .vie2(); on any jQuery object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">_create</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>automatically scans for xmlns attributes in the html element
and adds them to the global jQuery.VIE2.namespaces object</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">).</span><span class="nx">xmlns</span><span class="p">()</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    		<span class="p">});</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>scan for connector-specific namespaces</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">()[</span><span class="s1">&#39;namespaces&#39;</span><span class="p">])</span> <span class="p">{</span>
    				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">()[</span><span class="s1">&#39;namespaces&#39;</span><span class="p">]</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    					<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="o">;</span>
    				<span class="p">});</span>
    			<span class="p">}</span>
    		<span class="p">});</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>generates a unique id for VIE^2</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">))</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;No element id specified, generate one dynamically and add it!&quot;</span><span class="p">);</span>
    			<span class="kd">var</span> <span class="nx">tempId</span> <span class="o">=</span> <span class="nx">PseudoGuid</span><span class="p">.</span><span class="nx">GetNew</span><span class="p">();</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Generated id: &#39;&quot;</span> <span class="o">+</span> <span class="nx">tempId</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
    			<span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="o">,</span> <span class="nx">tempId</span><span class="p">);</span>
    		<span class="p">}</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>add all namespaces to the triple store cache in jQuery.VIE2.globalContext</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="k">this</span><span class="p">.</span><span class="nx">_initNamespaces</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span><span class="p">);</span>
    	<span class="p">}</span><span class="o">,</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><strong>_setOption()</strong>: Overwriting the jQuery UI widget factory method.</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">_setOption</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="o">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    		<span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">===</span> <span class="s1">&#39;namespaces&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>extends needs to be used as the default implementation
would overwrite the namespaces</p>             </td>             <td class="code">               <div class="highlight"><pre>    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span> <span class="p">(</span><span class="kc">true</span><span class="o">,</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="nx">value</span><span class="p">);</span>
    			<span class="k">this</span><span class="p">.</span><span class="nx">_initNamespaces</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span><span class="p">);</span>
    			<span class="k">this</span><span class="p">.</span><span class="nx">_initNamespaces</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localContext</span><span class="p">);</span>
    		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>super._setOption()...</p>             </td>             <td class="code">               <div class="highlight"><pre>    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setOption</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="p">[</span><span class="nx">key</span><span class="o">,</span> <span class="nx">value</span><span class="p">]);</span>
    		<span class="p">}</span>
    	<span class="p">}</span><span class="o">,</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><strong>_initNamespaces()</strong>: Convenience method to add the namespaces to
<em>jQuery.rdf</em> objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">_initNamespaces</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rdf</span><span class="p">)</span> <span class="p">{</span>
    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">rdf</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span>
    		<span class="p">});</span>
    	<span class="p">}</span><span class="o">,</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><strong>analyze(callback)</strong>: The analyze() method sends the element to all connectors and lets
them analyze the content. The connectors' methods are asynchronous calls and once all connectors
returned the found enrichments in the form of <em>jQuery.rdf</em> objects, the <em>callback</em> method is
executed (in the scope of the callback function, <em>this</em> refers to the element).<br />
The returned enrichments are written into the element's local context (this.options.localContext)
and also to the global context (jQuery.VIE2.globalContext).<br />
Furthermore, each found subject in the returned knowledge is checked if there is a mapping to 
backbone JS available and if so, the entity is added to the corresponding backbone collection(s).</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">analyze</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>analyze() does not actually need a callback method, but it is usually good to use it </p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;No callback method specified!&quot;</span><span class="p">);</span>
    		<span class="p">}</span>
    		
    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start.&quot;</span><span class="p">);</span>
    		    		</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>as the connectors work asynchronously, we need a queue to listen if all connectors are finished.</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="kd">var</span> <span class="nx">connectorQueue</span> <span class="o">=</span> <span class="p">[];</span>
    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>fill queue of connectors with 'id's to have an overview of running connectors.
this supports the asynchronous calls.</p>             </td>             <td class="code">               <div class="highlight"><pre>    			<span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    		<span class="p">});</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>iterate over all connectors</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>the connector's callback method</p>             </td>             <td class="code">               <div class="highlight"><pre>    			<span class="kd">var</span> <span class="nx">connectorCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conn</span><span class="o">,</span> <span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
    				<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rdf</span><span class="p">)</span> <span class="p">{</span>
    					<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Received RDF annotation from connector &#39;&quot;</span> <span class="o">+</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
    					</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>we add all namespaces to the rdfQuery object. 
Attention: this might override namespaces that were added by the connector!
but needed to keep consistency through VIE^2.</p>             </td>             <td class="code">               <div class="highlight"><pre>    					<span class="nx">that</span><span class="p">.</span><span class="nx">_initNamespaces</span><span class="p">(</span><span class="nx">rdf</span><span class="p">);</span>
    					
    					<span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>add all triples to the global cache!</p>             </td>             <td class="code">               <div class="highlight"><pre>    						<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>fill element-specific context</p>             </td>             <td class="code">               <div class="highlight"><pre>    						<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localContext</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    					<span class="p">});</span>
    					</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>add all subjects to the corresponding backbone collection(s)</p>             </td>             <td class="code">               <div class="highlight"><pre>    					<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">subjectIndex</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    						<span class="kd">var</span> <span class="nx">types</span> <span class="o">=</span> <span class="p">[];</span>
    						</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>an entity of id 'subject' can only be added once to a backbone JS collection
hence, we need to collect all types of that entity first in an array.
TODO: is this the right place to first ask all connectors for types?</p>             </td>             <td class="code">               <div class="highlight"><pre>    						<span class="nx">rdf</span>
    						<span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">subject</span> <span class="o">+</span> <span class="s1">&#39; a ?type&#39;</span><span class="p">)</span>
    						<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    							<span class="kd">var</span> <span class="nx">curie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">value</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
    							<span class="nx">types</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">curie</span><span class="p">);</span>
    						<span class="p">});</span>
    						<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">addBBEntity</span><span class="p">({</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">subject</span><span class="o">,</span> <span class="nx">a</span> <span class="o">:</span> <span class="nx">types</span><span class="p">});</span>
    					<span class="p">});</span>
    					
    					<span class="nx">removeElement</span><span class="p">(</span><span class="nx">connectorQueue</span><span class="o">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>everytime we receive annotations from each connector, we remove the connector's id from the
queue and check whether the queue is empty.</p>             </td>             <td class="code">               <div class="highlight"><pre>    					<span class="k">if</span> <span class="p">(</span><span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>if the queue is empty, all connectors have successfully returned and we can execute the
callback function.</p>             </td>             <td class="code">               <div class="highlight"><pre>    						<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished! Global context holds now &quot;</span> <span class="o">+</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>provide a status field in the callback object: status = {'ok', 'error'};</p>             </td>             <td class="code">               <div class="highlight"><pre>    						<span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    							<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">elem</span><span class="o">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">);</span>
    						<span class="p">}</span>
    					<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>TODO: in a future release, we might want to add a timeout to be called if a connector takes too long</p>             </td>             <td class="code">               <div class="highlight"><pre>    				<span class="p">};</span>
    			<span class="p">}(</span><span class="k">this</span><span class="o">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
    			</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>start analysis with the connector.</p>             </td>             <td class="code">               <div class="highlight"><pre> 				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Starting analysis with connector: &#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
    			<span class="k">this</span><span class="p">.</span><span class="nx">analyze</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="o">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="nx">connectorCallback</span><span class="p">);</span>
    		<span class="p">});</span>
    	<span class="p">}</span><span class="o">,</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p><strong>annotate(triples)</strong>: Supports the (manual) annotation of knowledge with (semantic) data.
the triples are written to both, the local context and global context. 
<em>triples</em> need to be either a <em>string</em> or an <em>array of strings</em>, containing the triplified data
in the rdfQuery triple format.</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">annotate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">triples</span><span class="p">)</span> <span class="p">{</span>
    		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    		<span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="o">;</span>
    		
    		<span class="k">if</span> <span class="p">(</span><span class="nx">triples</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;No triple specified, returning without action!&quot;</span><span class="p">);</span>
    			<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    		<span class="p">}</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>allocate temporary <em>jQuery.rdf</em> object with all known namespaces</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="kd">var</span> <span class="nx">rdf</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">({</span><span class="nx">namespaces</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
    		
    		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">triples</span><span class="p">))</span> <span class="p">{</span>
    			<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">annotate</span><span class="p">([</span><span class="nx">triples</span><span class="p">]</span><span class="o">,</span> <span class="nx">elem</span><span class="p">);</span>
    		<span class="p">}</span>
    		<span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>converting and adding all triples to the temporary <em>jQuery.rdf</em> object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">triples</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    				<span class="kd">var</span> <span class="nx">triple</span> <span class="o">=</span> <span class="nx">triples</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    				<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">triple</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
    					<span class="nx">triple</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="nx">triple</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
    				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>TODO: throw exception? 
TODO: check if jQuery.rdf.triple object!</p>             </td>             <td class="code">               <div class="highlight"><pre>    				<span class="p">}</span>
    				<span class="nx">rdf</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">triple</span><span class="p">);</span>					
    			<span class="p">});</span>
    		<span class="p">}</span>
    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start.&quot;</span><span class="p">);</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>(1) put the annotation into that.options.globalContext</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>(2) put the annotation into that.options.localContext</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
    			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localContext</span><span class="p">)</span> <span class="p">{</span>
    				<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localContext</span> <span class="o">=</span> <span class="nx">rdf</span><span class="o">;</span>
    			<span class="p">}</span>
    			<span class="k">else</span> <span class="p">{</span>
    				<span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    					<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localContext</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    				<span class="p">});</span>
    			<span class="p">}</span>
    		<span class="p">}</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>(3) look for backbone model(s) and update their attributes with each subject contained in the annotations.</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">subjectIndex</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    			<span class="kd">var</span> <span class="nx">triples</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">triples</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    				<span class="kd">var</span> <span class="nx">triple</span> <span class="o">=</span> <span class="nx">triples</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    					<span class="kd">var</span> <span class="nx">ent</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>

    					<span class="k">if</span> <span class="p">(</span><span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>only update the backbone entity if the property is a default property!</p>             </td>             <td class="code">               <div class="highlight"><pre>    						<span class="kd">var</span> <span class="nx">curie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="nx">triple</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
    						<span class="k">if</span> <span class="p">(</span><span class="nx">ent</span><span class="p">.</span><span class="nx">defaults</span><span class="p">[</span><span class="nx">curie</span><span class="p">])</span> <span class="p">{</span>
        						<span class="nx">ent</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;change:&#39;</span> <span class="o">+</span> <span class="nx">curie</span><span class="p">);</span>
        						<span class="nx">ent</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span>
    							<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;Added value to entity &#39;&quot;</span> <span class="o">+</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; &#39;&quot;</span> <span class="o">+</span> <span class="nx">curie</span> <span class="o">+</span> <span class="s2">&quot;&#39; &#39;&quot;</span> <span class="o">+</span> <span class="nx">triple</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
    						<span class="p">}</span>
    					<span class="p">}</span>
    				<span class="p">});</span>
    			<span class="p">});</span>
    		<span class="p">});</span>
    		</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>(4) register new entity/ies as backbone model(s)
this needs to be done <em>after</em> the properties have been loaded into
the cache, as 'addBBEntity() already performs a query for the entities'
properties.</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">subjectIndex</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    			<span class="kd">var</span> <span class="nx">types</span> <span class="o">=</span> <span class="p">[];</span>
    			</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>an entity of id 'id' can only be added once to a backbone JS collection
hence, we need to collect all types of that entity first in an array.
TODO: is this the right place to first ask all connectors for types?</p>             </td>             <td class="code">               <div class="highlight"><pre>    			<span class="nx">rdf</span>
    			<span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">subject</span> <span class="o">+</span> <span class="s1">&#39; a ?type&#39;</span><span class="p">)</span>
    			<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    				<span class="kd">var</span> <span class="nx">curie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">value</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
    				<span class="nx">types</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">curie</span><span class="p">);</span>
    			<span class="p">});</span>
    			
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">addBBEntity</span><span class="p">({</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">subject</span><span class="o">,</span> <span class="nx">a</span> <span class="o">:</span> <span class="nx">types</span><span class="p">});</span>
    		<span class="p">});</span>

    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;End.&quot;</span><span class="p">);</span>
    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;Global context holds now &quot;</span> <span class="o">+</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
    		<span class="k">if</span> <span class="p">(</span><span class="nx">elem</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#annotate()&quot;</span><span class="o">,</span> <span class="s2">&quot;Local cache of element &#39;&quot;</span> <span class="o">+</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; holds now &quot;</span> <span class="o">+</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localContext</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
    		<span class="p">}</span>
    		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    	<span class="p">}</span><span class="o">,</span>
    	
    	</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><strong>get(uri, prop)</strong>: Retrive properties from the given <em>uri</em> directly from the
element's context. Does <em>not</em> retrieve information from the global context. </p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>get data from local storage!</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
    		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    		<span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localContext</span>
    		<span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">pattern</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">prop</span><span class="o">,</span> <span class="s1">&#39;?object&#39;</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">}))</span>
    		<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    			<span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span>
    		<span class="p">});</span>
    		
    		<span class="k">return</span> <span class="nx">ret</span><span class="o">;</span>
    	<span class="p">}</span><span class="o">,</span>
    	
    	</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p><strong>copy(tar)</strong>: Copies all local knowledge to the target element(s).
Basically calls: <pre>
$(tar).vie2().vie2('annotate', that.options.localContext.databank.triples());
</pre></p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">copy</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">tar</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>copy all knowledge from src to target</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tar</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#copy()&quot;</span><span class="o">,</span> <span class="s2">&quot;Invoked &#39;copy()&#39; without target element!&quot;</span><span class="p">);</span>
    			<span class="k">return</span><span class="o">;</span>
    		<span class="p">}</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#copy()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start.&quot;</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#copy()&quot;</span><span class="o">,</span> <span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localContext</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples for source (&quot;</span> <span class="o">+</span> <span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;vie2-id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;).&quot;</span><span class="p">);</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="nx">tar</span><span class="p">).</span><span class="nx">vie2</span><span class="p">().</span><span class="nx">vie2</span><span class="p">(</span><span class="s1">&#39;annotate&#39;</span><span class="o">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localContext</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">());</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#copy()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished.&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    	<span class="p">}</span><span class="o">,</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p><strong>clear()</strong>: Clears the local context.</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">clear</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    		<span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">localConext</span> <span class="o">=</span> <span class="p">{};</span>
    		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    	<span class="p">}</span>
    	
    <span class="p">});</span>
<span class="p">}(</span><span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p><strong>$.VIE2.namespaces</strong>: There are currently <em>no</em> default namespaces, though
we might want to change this in a future release.
Namespaces can be overridden directly using jQuery.VIE2.namespaces[x] = y but
are parsed from the &lt;html> tag anyway during initialization.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p><strong>$.VIE2.globalContext</strong>: The variable <strong>globalContext</strong> stores all knowledge in
triples that were retrieved and annotated so far in one <em>rdfQuery object</em>. Though it is
available via $.VIE2.globalContext, it is highly discouraged to access it directly.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">({</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p><strong>get(uri, prop)</strong>: Retrive properties from the given <em>uri</em> directly from the
element's context. Does <em>not</em> retrieve information from the global context. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">getFromGlobalContext</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>get data from local storage!</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
	
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span>
	<span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">pattern</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">prop</span><span class="o">,</span> <span class="s1">&#39;?object&#39;</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">}))</span>
	<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span>
	<span class="p">});</span>
	
	<span class="k">return</span> <span class="nx">ret</span><span class="o">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p><strong>$.VIE2.query(uri, props, callback, otions)</strong>: The query function supports querying for properties. The uri needs
to be of type <code>jQuery.rdf</code> object or a simple string and the property is either an array of strings
or a simple string. The function iterates over all connectors that have <code>query()</code>
implemented and collects data in an object.
The callback retrieves an object with the properties as keys and an array of results as their corresponding values.
The <i>options</i> is an object that supports the following keys:
options.cache : {'nocache', 'cacheonly'} -> nocache: do not use the cache but query for data online
-> cacheonly: query offline only
TODO: update usage of options!</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">props</span><span class="o">,</span> <span class="nx">callback</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;$.VIE2.query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start!&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">uri</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">props</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;$.VIE2.query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Invoked &#39;query()&#39; with undefined argument(s)!&quot;</span><span class="p">);</span>
		<span class="nx">callback</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
		<span class="k">return</span><span class="o">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">props</span><span class="p">))</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="p">[</span><span class="nx">props</span><span class="p">]</span><span class="o">,</span> <span class="nx">callback</span><span class="o">,</span> <span class="nx">options</span><span class="p">);</span>
		<span class="k">return</span><span class="o">;</span>
	<span class="p">}</span>
	
	<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">uri</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">props</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>initialize the returning object</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">ret</span><span class="p">[</span><span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>look up for properties in options.globalContext
first check if we should ignore the cache!</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span> <span class="o">||</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">cache</span> <span class="o">===</span> <span class="s1">&#39;nocache&#39;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span>
				<span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">pattern</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="s1">&#39;?object&#39;</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">}))</span>
				<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">ret</span><span class="p">[</span><span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">);</span>
				<span class="p">});</span>
			<span class="p">}</span>
		<span class="p">}</span>
		</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>finish here if said so!</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">cache</span> <span class="o">===</span> <span class="s1">&#39;cacheonly&#39;</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">callback</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
			<span class="k">return</span><span class="o">;</span>
		<span class="p">}</span>
		
		<span class="kd">var</span> <span class="nx">connectorQueue</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>fill queue of connectors with 'id's to have an overview of running connectors.
this supports the asynchronous calls.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
		<span class="p">});</span>
		</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>look up for properties in the connectors that
implement/overwrite the query() method</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;$.VIE2.query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start with connector &#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; for uri &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conn</span><span class="o">,</span> <span class="nx">uri</span><span class="o">,</span> <span class="nx">ret</span><span class="o">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;$.VIE2.query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Received query information from connector &#39;&quot;</span> <span class="o">+</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; for uri &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
					<span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="o">,</span> <span class="nx">ret</span><span class="o">,</span> <span class="nx">data</span><span class="p">);</span>
					
					<span class="nx">removeElement</span><span class="p">(</span><span class="nx">connectorQueue</span><span class="o">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>if the queue is empty, all connectors have successfully returned and we can call the
callback function.</p>             </td>             <td class="code">               <div class="highlight"><pre>						</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>adding new information to cache!</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">ret</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
							<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
								<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">}));</span>
							<span class="p">}</span>
						<span class="p">});</span>
						<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;$.VIE2.query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished task: &#39;query()&#39; for uri &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
						<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;$.VIE2.query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Global context now holds &quot;</span> <span class="o">+</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
						<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
						<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">};</span>
			<span class="p">}(</span><span class="k">this</span><span class="o">,</span> <span class="nx">uri</span><span class="o">,</span> <span class="nx">ret</span><span class="o">,</span> <span class="nx">callback</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">props</span><span class="o">,</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="nx">c</span><span class="p">);</span>
		<span class="p">});</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">callback</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p><strong>$.VIE2.clearContext()</strong>: Static method to clear the global context.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">clearContext</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">({</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p><strong>$.VIE2.log(level, component, message)</strong>: Static convenience method for logging.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">level</span><span class="o">,</span> <span class="nx">component</span><span class="o">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">switch</span> <span class="p">(</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">case</span> <span class="s2">&quot;info&quot;</span><span class="o">:</span>
    	<span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">component</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
    	<span class="k">break</span><span class="o">;</span>
    <span class="nx">case</span> <span class="s2">&quot;warn&quot;</span><span class="o">:</span>
    	<span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">component</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
    	<span class="k">break</span><span class="o">;</span>
    <span class="nx">case</span> <span class="s2">&quot;error&quot;</span><span class="o">:</span>
    	<span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">component</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
    	<span class="k">break</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p><strong>$.VIE2.connectors</strong>: Static object of all registered connectors.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p><strong>$.VIE2.registerConnector(connector)</strong>: Static method to register a connector (is automatically called 
during construction of connector class. If set, inserts connector-specific namespaces to the known contexts.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">registerConnector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">connector</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>first check if there is already 
a connector with 'connector.id' registered</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="p">[</span><span class="nx">connector</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
    	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="p">[</span><span class="nx">connector</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">connector</span><span class="o">;</span>
    	<span class="k">if</span> <span class="p">(</span><span class="nx">connector</span><span class="p">.</span><span class="nx">_options</span><span class="p">[</span><span class="s2">&quot;namespaces&quot;</span><span class="p">])</span> <span class="p">{</span>
    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">connector</span><span class="p">.</span><span class="nx">_options</span><span class="p">[</span><span class="s2">&quot;namespaces&quot;</span><span class="p">]</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalContext</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>also add to all known VIE^2 elements' context!</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="p">});</span>
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.VIE2-vie2&#39;</span><span class="p">).</span><span class="nx">vie2</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="o">,</span> <span class="s1">&#39;namespaces&#39;</span><span class="o">,</span> <span class="nx">connector</span><span class="p">.</span><span class="nx">_options</span><span class="p">[</span><span class="s2">&quot;namespaces&quot;</span><span class="p">]);</span>
    	<span class="p">}</span>
    	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerConnector()&quot;</span><span class="o">,</span> <span class="s2">&quot;Registered connector &#39;&quot;</span> <span class="o">+</span> <span class="nx">connector</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
    	
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerConnector()&quot;</span><span class="o">,</span> <span class="s2">&quot;Did not register connector, as there is&quot;</span> <span class="o">+</span>
    			<span class="s2">&quot;already a connector with the same id registered.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p><strong>$.VIE2.unregisterConnector(connectorId)</strong>: Unregistering of connectors. There is currently
no usecase for that, but it wasn't that hard to implement ;)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">unregisterConnector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">connectorId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="p">[</span><span class="nx">connector</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="o">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p><strong>$.VIE2.Backbone</strong>: Contains for all registered mappings (mapping.id is the key), the
following items:<br/>
* jQuery.VIE2.Backbone[id].a -> an array of strings (curies) of the corresponding type.
* jQuery.VIE2.Backbone[id].mapping -> the mapping itself
* jQuery.VIE2.Backbone[id].collection -> the backbone JS collection, that has the Model registered. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p><strong>$.VIE2.Entity</strong>: The parent backbone entity class for all other entites.
Inherits from VIE.RDFEntity.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Entity</span> <span class="o">=</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">RDFEntity</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    
    <span class="nx">lookup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">props</span><span class="p">))</span> <span class="p">{</span>
    		<span class="k">this</span><span class="p">.</span><span class="nx">lookup</span><span class="p">([</span><span class="nx">props</span><span class="p">]);</span>
    	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>query connectors for properties</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">props</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
    			<span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">props</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    					<span class="nx">entity</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;change:&#39;</span> <span class="o">+</span> <span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    					<span class="nx">entity</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span>
    				<span class="p">});</span>
    			<span class="p">};</span>
    		<span class="p">}(</span><span class="k">this</span><span class="p">));</span>
    	<span class="p">}</span>
    <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>TODO: overwrite 'set();'
TODO: overwrite 'unset();'
TODO: overwrite 'clear();'</p>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
    	<span class="k">return</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">getFromGlobalContext</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attr</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>forward VIE2.annotate(this.id, attrs);!</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>TODO!</p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="c">/*var triples = [];</span>
<span class="c">    	var that = this;</span>
<span class="c">    	jQuery.each(attrs, function (k, v) {</span>
<span class="c">    		var triple = that.id + &#39; &#39; + k + &#39; &#39; + v;</span>
<span class="c">    		triples.push(triple);</span>
<span class="c">    	});</span>
<span class="c">    	VIE2.vie2(&#39;annotate&#39;, triples);*/</span>
    <span class="p">}</span>

<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p><strong>$.VIE2.addBBEntity(entity)</strong>: Add a backbone model to the corresponding collection(s).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">addBBEntity</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    	<span class="kd">var</span> <span class="nx">belongsHere</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    		<span class="kd">var</span> <span class="nx">ans</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span> <span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]);</span>
    		<span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span> <span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    			<span class="nx">belongsHere</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    		<span class="p">}</span>
    	<span class="p">});</span>
    	<span class="k">if</span> <span class="p">(</span><span class="nx">belongsHere</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>check if there exists already a model with the same id</p>             </td>             <td class="code">               <div class="highlight"><pre>    		<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]))</span> <span class="p">{</span>
    			<span class="nx">e</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]).</span><span class="nx">change</span><span class="p">();</span>
	    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#addBBEntity()&quot;</span><span class="o">,</span> <span class="s2">&quot;Entity with id &#39;&quot;</span> <span class="o">+</span> <span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; already exists as a backbone model!&quot;</span><span class="p">);</span>
    		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    		<span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">e</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">model</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>instantiating model</p>             </td>             <td class="code">               <div class="highlight"><pre>	    		<span class="kd">var</span> <span class="nx">modelInstance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">(</span><span class="nx">entity</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>adding model instance to collection</p>             </td>             <td class="code">               <div class="highlight"><pre>	    		<span class="nx">e</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">);</span>
	    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#addBBEntity()&quot;</span><span class="o">,</span> <span class="s2">&quot;Added entity &#39;&quot;</span> <span class="o">+</span> <span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; to collection of type &#39;&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
	    		<span class="kd">var</span> <span class="nx">mapping</span> <span class="o">=</span> <span class="nx">e</span><span class="p">[</span><span class="s1">&#39;mapping&#39;</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>query for default properties to make them available in the offline storage</p>             </td>             <td class="code">               <div class="highlight"><pre>	    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#addBBEntity()&quot;</span><span class="o">,</span> <span class="s2">&quot;Querying for default properties for entity &#39;&quot;</span> <span class="o">+</span> <span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;: [&quot;</span> <span class="o">+</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">defaultProps</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]!&quot;</span><span class="p">);</span>
	    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">defaultProps</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">defProps</span><span class="o">,</span> <span class="nx">modelInstance</span><span class="p">)</span> <span class="p">{</span>
	    			<span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	    	    		<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#addBBEntity()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished querying for default properties for entity &#39;&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;: [&quot;</span> <span class="o">+</span> <span class="nx">defProps</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]!&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>trigger change when finished</p>             </td>             <td class="code">               <div class="highlight"><pre>	    				<span class="nx">modelInstance</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span>
	    			<span class="p">};</span>
	    		<span class="p">}(</span><span class="nx">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">,</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">defaultProps</span><span class="o">,</span> <span class="nx">modelInstance</span><span class="p">));</span>
	    	<span class="p">}</span>
    	<span class="p">}</span>
    <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p><strong>$.VIE2.registerMapping(mapping)</strong>: Static method to register a mapping (is automatically called 
during construction of mapping class. This allocates an object in <em>jQuery.VIE2.Backbone[mapping.id]</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">registerMapping</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mapping</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>first check if there is already 
a mapping with 'mapping.id' registered    </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
    	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerMapping()&quot;</span><span class="o">,</span> <span class="s2">&quot;Registered mapping &#39;&quot;</span> <span class="o">+</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
    	</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>backboneJS mapping        </p>             </td>             <td class="code">               <div class="highlight"><pre>    	<span class="kd">var</span> <span class="nx">props</span> <span class="o">=</span> <span class="p">{};</span>
    	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">defaultProps</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    		<span class="nx">props</span><span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">defaultProps</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[];</span>
    	<span class="p">});</span>
    	
    	<span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Entity</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">defaults</span><span class="o">:</span> <span class="nx">props</span><span class="p">});</span>
    	<span class="kd">var</span> <span class="nx">Collection</span> <span class="o">=</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">RDFEntityCollection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">Model</span><span class="p">});</span>
    	
    	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    			<span class="s2">&quot;a&quot;</span> <span class="o">:</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">types</span><span class="p">))</span><span class="o">?</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">types</span> <span class="o">:</span> <span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">types</span><span class="p">]</span><span class="o">,</span>
    			<span class="s2">&quot;collection&quot;</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">()</span><span class="o">,</span>
    			<span class="s2">&quot;mapping&quot;</span> <span class="o">:</span> <span class="nx">mapping</span>
    	<span class="p">};</span>
    	
    	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerMapping()&quot;</span><span class="o">,</span> <span class="s2">&quot;Registered mapping &#39;&quot;</span> <span class="o">+</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; finished!&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#registerMapping()&quot;</span><span class="o">,</span> <span class="s2">&quot;Did not register mapping, as there is&quot;</span> <span class="o">+</span>
    			<span class="s2">&quot;already a mapping with the same id registered.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p><strong>$.VIE2.unregisterMapping(mappingId)</strong>: Unregistering of mappings. There is currently
no usecase for that, but it wasn't that hard to implement ;)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">unregisterMapping</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mappingId</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">[</span><span class="nx">mappingId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="o">;</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 