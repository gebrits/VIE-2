<!DOCTYPE html>  <html> <head>   <title>vie2-latest.debug.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="vie2-latest.debug.html">                 vie2-latest.debug.js               </a>                                           <a class="source" href="node_proxy.html">                 node_proxy.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               vie2-latest.debug.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>VIE&sup2; - Vienna IKS Editable Entities
(c) 2011 Sebastian Germesin, IKS Consortium
VIE&sup2; may be freely distributed under the MIT license.
(see LICENSE.txt)
For all details and documentation:
http://wiki.iks-project.eu/index.php/VIE^2</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Initial setup</h2>

<p>The VIE&sup2; library is fully contained inside a VIE2 namespace.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">VIE2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">VIE2</span> <span class="o">=</span> <span class="p">{};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>VIE&sup2; is the semantic enrichment layer on top of VIE.
Its acronym stands for <b>V</b>ienna <b>I</b>KS <b>E</b>ditable <b>E</b>ntities.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>With the help of VIE&sup2;, you can bring entites in your
content (aka. semantic lifting) and furthermore interact
with this knowledge in a MVC manner - using Backbone JS models
and collections. It is important to say that VIE&sup2; helps you to
automatically annotate data but also let's you enable users
to change/add/remove entities and their properties at the users
wish.
VIE&sup2; has two main principles: </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <ul>
<li>Connectors:
Connecting VIE&sup2; with <strong>backend</strong> services, that
can either analyse and enrich the content sent to them (e.g., using
Apache Stanbol or Zemanta), can act as knowledge databases (e.g., DBPedia)
or as serializer (e.g., RDFa).</li>
<li>Mappings:
In a mapping, a web developer can specify a mapping from ontological entities
to backbone JS models. The developer can easily add types of entities and
also default attributes that are automatically filled with the help of the 
available connectors.
File:   core.js
Author: <a href="mailto:sebastian.germesin@dfki.de">Sebastian Germesin</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="o">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>VIE&sup2; is implmented as a <a href="http://semantic-interaction.org/blog/2011/03/01/jquery-ui-widget-factory/">jQuery UI widget</a>. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s1">&#39;VIE2.vie2&#39;</span><span class="o">,</span> <span class="p">{</span>
        </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>default options</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">entities</span> <span class="o">:</span> <span class="p">[]</span>
        <span class="p">}</span><span class="o">,</span>
        </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><strong><em>create()</strong>: The private method <strong></em>create():</strong> is called implicitly when
calling .vie2(); on any jQuery object.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_create</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>            </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>automatically scans for xmlns attributes in the <strong>html</strong> element
and adds them to the global VIE2.namespaces object</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">).</span><span class="nx">xmlns</span><span class="p">()</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span>
            <span class="p">});</span>
            </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>automatically scans for xmlns attributes in the <strong>given</strong> element
and adds them to the global VIE2.namespaces object</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">xmlns</span><span class="p">()</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">){</span>
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>needs to be ignored when called on $(document);</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#create()&quot;</span><span class="o">,</span> <span class="s2">&quot;Could not retrieve namespaces from element: &#39;&quot;</span> <span class="o">+</span> <span class="nx">e</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">,</span>
        </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><strong>analyze(callback,[options])</strong>: The analyze() method sends the element to all connectors and lets
them analyze the content. The connectors' methods are asynchronously called and once all connectors
returned the found enrichments in the form of <strong>jQuery.rdf objects</strong>, the <em>callback</em> method is
executed (in the scope of the callback function, <em>this</em> refers to the given element).<br />
The returned enrichments are written into the global Cache of VIE&sup2; (VIE2.globalCache).<br />
Furthermore, each found subject in the returned knowledge is checked whether there is a mapping to 
backbone JS available and if so, the entity is added to the corresponding backbone collection(s).
<em>options</em> can contain a 'connectors' field. If so, only these connectors will be used
for the analysis. If not specified, all connectors are used.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">analyze</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};}</span>
            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>analyze() does not actually need a callback method, but it is usually good to use it </p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;No callback method specified!&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Started.&quot;</span><span class="p">);</span>
                        </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>as the connectors work asynchronously, we need a queue to listen if all connectors are finished.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">connectorQueue</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>fill queue of connectors with 'id's to have an overview of running connectors.
this supports the asynchronous calls.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">connectors</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">connectors</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
            </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>iterate over all connectors</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>the connector's success callback method</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">successCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rdf</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Received RDF annotation from connector &#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
                        </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>we add all namespaces to the rdfQuery object. 
Attention: this might override namespaces that were added by the connector!
but needed to keep consistency through VIE&sup2;.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">rdf</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span>
                        <span class="p">});</span>

                        <span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>add all triples to the global cache!</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
                        <span class="p">});</span>
                        </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>register all subjects as backbone model</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">subjectIndex</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">subjStr</span> <span class="o">=</span> <span class="nx">subject</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">subjStr</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">subjStr</span><span class="p">);</span>
                            <span class="p">}</span>
                            
                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">EntityManager</span><span class="p">.</span><span class="nx">getBySubject</span><span class="p">(</span><span class="nx">subjStr</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Register new entity (&quot;</span> <span class="o">+</span> <span class="nx">subjStr</span> <span class="o">+</span> <span class="s2">&quot;)!&quot;</span><span class="p">);</span>
                                
                                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">createEntity</span><span class="p">({</span>
                                  <span class="nx">id</span> <span class="o">:</span> <span class="nx">subjStr</span>
                                <span class="p">}</span><span class="o">,</span> <span class="p">{</span><span class="nx">backend</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nx">VIE</span><span class="p">.</span><span class="nx">EntityManager</span><span class="p">.</span><span class="nx">getBySubject</span><span class="p">(</span><span class="nx">subjStr</span><span class="p">).</span><span class="nx">change</span><span class="p">();</span>
                            <span class="p">}</span>
                        <span class="p">});</span>
                        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">removeElement</span><span class="p">(</span><span class="nx">connectorQueue</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>everytime we receive annotations from each connector, we remove the connector's id from the
queue and check whether the queue is empty.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">if</span> <span class="p">(</span><span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>if the queue is empty, all connectors have successfully returned and we can execute the
callback function.</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished! Global Cache holds now &quot;</span> <span class="o">+</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
                            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished! Local element holds now &quot;</span>  <span class="o">+</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; entities!&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>provide a status field in the callback object: status = {'ok', 'error'};</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">};</span>
                <span class="p">}</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
                </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>the connector's error callback method</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">errorCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Connector (&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;) returned with the following error: &#39;&quot;</span> <span class="o">+</span> <span class="nx">reason</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">removeElement</span><span class="p">(</span><span class="nx">connectorQueue</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="p">};</span>
                </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>check if we may need to filter for the connector</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">connectors</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">connectors</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>start analysis with the connector.</p>             </td>             <td class="code">               <div class="highlight"><pre>                         <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Starting analysis with connector: &#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">analyze</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="o">,</span> <span class="p">{</span>
                            <span class="nx">success</span><span class="o">:</span> <span class="nx">successCallback</span><span class="o">,</span>
                            <span class="nx">error</span><span class="o">:</span> <span class="nx">errorCallback</span>
                        <span class="p">});</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Will not use connector &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; as it is filtered!&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>start analysis with the connector.</p>             </td>             <td class="code">               <div class="highlight"><pre>                     <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Starting analysis with connector: &#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">analyze</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="o">,</span> <span class="p">{</span>
                        <span class="nx">success</span><span class="o">:</span> <span class="nx">successCallback</span><span class="o">,</span>
                        <span class="nx">error</span><span class="o">:</span> <span class="nx">errorCallback</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span><span class="o">,</span>
                </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p><strong>uris()</strong>: Returns a list of all uris, that are within the scope of the current element!</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">uris</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entities</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>
                </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p><strong>copy(tar)</strong>: Copies all local knowledge to the target element(s).
Basically calls: <pre>
$(tar).vie2().vie2('option', 'entities', this.options.entities);
</pre></p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">copy</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">tar</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>copy all knowledge from src to target</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tar</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#copy()&quot;</span><span class="o">,</span> <span class="s2">&quot;Invoked &#39;copy()&#39; without target element!&quot;</span><span class="p">);</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#copy()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start.&quot;</span><span class="p">);</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#copy()&quot;</span><span class="o">,</span> <span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; entities for source.&quot;</span><span class="p">);</span>
            
            <span class="nx">jQuery</span><span class="p">(</span><span class="nx">tar</span><span class="p">).</span><span class="nx">vie2</span><span class="p">().</span><span class="nx">vie2</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="o">,</span> <span class="s1">&#39;entities&#39;</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entities</span><span class="p">);</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#copy()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished.&quot;</span><span class="p">);</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.core#copy()&quot;</span><span class="o">,</span> <span class="s2">&quot;Target element has now &quot;</span> <span class="o">+</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">tar</span><span class="p">).</span><span class="nx">vie2</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="o">,</span> <span class="s1">&#39;entities&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; entities.&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span><span class="o">,</span>
        </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p><strong>clear()</strong>: Clears the local entities.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">clear</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">entities</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="p">}</span>
        
    <span class="p">});</span>
<span class="p">}(</span><span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>The global <strong>VIE2 object</strong>. If VIE2 is already defined, the
existing VIE2 object will not be overwritten so that the
defined object is preserved.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">VIE2</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="o">!</span><span class="nx">VIE2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VIE2</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p><strong>VIE2.namespaces</strong>: This map contains all namespaces known to VIE2.
There are currently <em>no</em> default namespaces, though
we might want to change this in a future release.
Namespaces can be overridden directly using VIE2.namespaces[x] = y but
are parsed from the &lt;html> tag's xmlns: attribute anyway during initialization.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p><strong>VIE2.globalCache</strong>: The variable <strong>globalCache</strong> stores all knowledge in
triples that were retrieved and annotated so far in one <em>rdfQuery object</em>. Though it is
available via VIE2.globalCache, it is highly discouraged to access it directly.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">({</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p><strong>VIE2.clearCache()</strong>: Static method to clear the global Cache.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">clearCache</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">({</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p><strong>VIE2.getFromCache(uri, prop)</strong>: Retrive properties from the given
<em>uri</em> directly from the global Cache. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">getFromCache</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">parent</span><span class="o">,</span> <span class="nx">uri</span><span class="o">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>initialize collection</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">Collection</span> <span class="o">=</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">ObjectCollection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">uri</span>      <span class="o">:</span> <span class="nx">uri</span><span class="o">,</span>
        <span class="nx">property</span> <span class="o">:</span> <span class="nx">prop</span><span class="o">,</span>
        <span class="nx">parent</span><span class="o">:</span> <span class="nx">parent</span>
    <span class="p">});</span>
    
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">();</span>
    
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span>
    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">pattern</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">prop</span><span class="o">,</span> <span class="s1">&#39;?object&#39;</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">}))</span>
    <span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;literal&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">createLiteral</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">value</span><span class="o">,</span> <span class="p">{</span><span class="nx">lang</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">lang</span><span class="o">,</span> <span class="nx">datatype</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">datatype</span><span class="o">,</span> <span class="nx">backend</span><span class="o">:</span><span class="kc">true</span><span class="o">,</span> <span class="nx">silent</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
                <span class="nx">ret</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">inst</span><span class="o">,</span> <span class="p">{</span><span class="nx">backend</span><span class="o">:</span><span class="kc">true</span><span class="o">,</span> <span class="nx">silent</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;uri&#39;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;bnode&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">EntityManager</span><span class="p">.</span><span class="nx">getBySubject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ret</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">VIE</span><span class="p">.</span><span class="nx">EntityManager</span><span class="p">.</span><span class="nx">getBySubject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span><span class="o">,</span> <span class="p">{</span><span class="nx">backend</span><span class="o">:</span><span class="kc">true</span><span class="o">,</span> <span class="nx">silent</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">createResource</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">,</span> <span class="p">{</span><span class="nx">backend</span><span class="o">:</span><span class="kc">true</span><span class="o">,</span> <span class="nx">silent</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
                    <span class="nx">ret</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">inst</span><span class="o">,</span> <span class="p">{</span><span class="nx">backend</span><span class="o">:</span><span class="kc">true</span><span class="o">,</span> <span class="nx">silent</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="nx">ret</span><span class="o">;</span>
<span class="p">};</span>

<span class="nx">VIE2</span><span class="p">.</span><span class="nx">removeFromCache</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">prop</span><span class="o">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">pattern</span><span class="p">(</span>
    <span class="nx">uri</span><span class="o">,</span> 
    <span class="p">(</span><span class="nx">prop</span><span class="p">)</span><span class="o">?</span> <span class="nx">prop</span> <span class="o">:</span> <span class="s1">&#39;?x&#39;</span><span class="o">,</span>
    <span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="o">?</span> <span class="nx">val</span> <span class="o">:</span> <span class="s1">&#39;?y&#39;</span><span class="o">,</span> 
    <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.removeFromCache()&quot;</span><span class="o">,</span> <span class="s2">&quot;Removing triples that match: &#39;&quot;</span> <span class="o">+</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.removeFromCache()&quot;</span><span class="o">,</span> <span class="s2">&quot;Global Cache now holds &quot;</span> <span class="o">+</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span>
    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">pattern</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">pattern</span><span class="p">);</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.removeFromCache()&quot;</span><span class="o">,</span> <span class="s2">&quot;Global Cache now holds &quot;</span> <span class="o">+</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p><strong>VIE2.lookup(uri, props, callback)</strong>: The query function supports querying for properties. The uri needs
to be of type <code>jQuery.rdf</code> object or a simple string and the property is either an array of strings
or a simple string. The function iterates over all connectors that have <code>query()</code>
implemented and collects data in an object.
The callback retrieves an object with the properties as keys and an array of results as their corresponding values.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">lookup</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">props</span><span class="o">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.lookup()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start (&#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nx">props</span> <span class="o">+</span> <span class="s2">&quot;&#39;)!&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">uri</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">uri</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="nx">props</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.lookup()&quot;</span><span class="o">,</span> <span class="s2">&quot;Invoked &#39;lookup()&#39; with wrong/undefined argument(s)!&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">ret</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">props</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="p">[</span> <span class="nx">props</span> <span class="p">]</span><span class="o">,</span> <span class="nx">callback</span><span class="p">);</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>initialize the returning object</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ret</span><span class="p">[</span><span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
                
    <span class="kd">var</span> <span class="nx">connectorQueue</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>fill queue of connectors with 'id's to have an overview of running connectors.
this supports the asynchronous calls.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">});</span>
    </pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>look up for properties in the connectors that
implement/overwrite the query() method</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.lookup()&quot;</span><span class="o">,</span> <span class="s2">&quot;Start with connector &#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; for uri &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">ret</span><span class="o">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.lookup()&quot;</span><span class="o">,</span> <span class="s2">&quot;Received query information from connector &#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; for uri &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
                <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">data</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">triple</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
                        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">triple</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">removeElement</span><span class="p">(</span><span class="nx">connectorQueue</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">connectorQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>if the queue is empty, all connectors have successfully returned and we can call the
callback function.</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">ret</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span>
                        <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">uri</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s1">&#39; ?x&#39;</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">valStr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">valStr</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">ret</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">valStr</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">});</span>
                    <span class="p">});</span>
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.lookup()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished task: &#39;query()&#39; for uri &#39;&quot;</span> <span class="o">+</span> <span class="nx">uri</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.lookup()&quot;</span><span class="o">,</span> <span class="s2">&quot;Global Cache now holds &quot;</span> <span class="o">+</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">databank</span><span class="p">.</span><span class="nx">triples</span><span class="p">().</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples!&quot;</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">ret</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">};</span>
        <span class="p">}(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">ret</span><span class="o">,</span> <span class="nx">callback</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">props</span><span class="o">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><strong>VIE2.mappings</strong>: Contains for all registered mappings (mapping.id is the key), the
following items:<br/>
* VIE2.mappings[id].a -> an array of strings (curies) of the corresponding type.
* VIE2.mappings[id].mapping -> the mapping itself
* VIE2.mappings[id].collection -> the backbone JS collection, that has the Model registered. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p><strong>VIE2.registerMapping(mapping)</strong>: Static method to register a mapping (is automatically called 
during construction of mapping class. This allocates an object in <em>VIE2.mappings[mapping.id]</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">registerMapping</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mapping</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>first check if there is already 
a mapping with 'mapping.id' registered    </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span><span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
                
        <span class="kd">var</span> <span class="nx">Collection</span> <span class="o">=</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">EntityCollection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">Entity</span><span class="p">});</span>
        
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span><span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;a&quot;</span> <span class="o">:</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">types</span><span class="p">))</span><span class="o">?</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">types</span> <span class="o">:</span> <span class="p">[</span><span class="nx">mapping</span><span class="p">.</span><span class="nx">types</span><span class="p">]</span><span class="o">,</span>
            <span class="s2">&quot;collection&quot;</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">()</span><span class="o">,</span>
            <span class="s2">&quot;mapping&quot;</span> <span class="o">:</span> <span class="nx">mapping</span>
        <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>trigger filling of collections!</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">searchCollections</span><span class="p">();</span>
        <span class="p">}</span>
        
        
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.registerMapping()&quot;</span><span class="o">,</span> <span class="s2">&quot;  Registered mapping &#39;&quot;</span> <span class="o">+</span> <span class="nx">mapping</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.registerMapping()&quot;</span><span class="o">,</span> <span class="s2">&quot;Did not register mapping, as there is&quot;</span> <span class="o">+</span>
                <span class="s2">&quot;already a mapping with the same id registered.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p><strong>VIE2.unregisterMapping(mappingId)</strong>: Unregistering of mappings. There is currently
no usecase for that, but it wasn't that hard to implement ;)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">unregisterMapping</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mappingId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span><span class="p">[</span><span class="nx">mappingId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="o">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p><strong>VIE2.connectors</strong>: Static object of all registered connectors.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p><strong>VIE2.registerConnector(connector)</strong>: Static method to register a connector (is automatically called 
during construction of connector class. If set, inserts connector-specific namespaces to the known Caches.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">registerConnector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">connector</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>first check if there is already 
a connector with 'connector.id' registered</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="p">[</span><span class="nx">connector</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="p">[</span><span class="nx">connector</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">connector</span><span class="o">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">connector</span><span class="p">.</span><span class="nx">options</span><span class="p">(</span><span class="s1">&#39;namespaces&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">connector</span><span class="p">.</span><span class="nx">options</span><span class="p">(</span><span class="s1">&#39;namespaces&#39;</span><span class="p">)</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="o">;</span>
                <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>also add to all known VIE&sup2; elements' Cache!</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="p">});</span>
        <span class="p">}</span>
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.registerConnector()&quot;</span><span class="o">,</span> <span class="s2">&quot;Registered connector &#39;&quot;</span> <span class="o">+</span> <span class="nx">connector</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
        
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.registerConnector()&quot;</span><span class="o">,</span> <span class="s2">&quot;Did not register connector, as there is&quot;</span> <span class="o">+</span>
                <span class="s2">&quot;already a connector with the same id registered.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p><strong>VIE2.unregisterConnector(connectorId)</strong>: Unregistering of connectors. There is currently
no usecase for that, but it wasn't that hard to implement ;)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">unregisterConnector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">connectorId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="p">[</span><span class="nx">connector</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="o">;</span>
<span class="p">};</span>

<span class="nx">VIE2</span><span class="p">.</span><span class="nx">logLevels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;warn&quot;</span><span class="o">,</span> <span class="s2">&quot;error&quot;</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p><strong>VIE2.log(level, component, message)</strong>: Static convenience method for logging.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">level</span><span class="o">,</span> <span class="nx">component</span><span class="o">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">logLevels</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">level</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">switch</span> <span class="p">(</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">case</span> <span class="s2">&quot;info&quot;</span><span class="o">:</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">component</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="nx">case</span> <span class="s2">&quot;warn&quot;</span><span class="o">:</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">component</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="nx">case</span> <span class="s2">&quot;error&quot;</span><span class="o">:</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">component</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>File:   collection.js
Author: <a href="mailto:sebastian.germesin@dfki.de">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>just for convenience, should be removed in a later revision</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE</span><span class="p">.</span><span class="nx">EntityManager</span><span class="p">.</span><span class="nx">initializeCollection</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p><strong>VIE2.EntityCollection</strong>: TODO: document me</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">EntityCollection</span> <span class="o">=</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">RDFEntityCollection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    </pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>overwrite the internal _add method</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};}</span>
        <span class="nx">VIE</span><span class="p">.</span><span class="nx">RDFEntityCollection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_add</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>if the annotation does <em>not</em> come from the analyze() method
it comes from the user and hence,
we need to add the subject to the internal triple store.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">backend</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">triple</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span>
                <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">,</span> 
                <span class="s1">&#39;a&#39;</span><span class="o">,</span> 
                <span class="s1">&#39;owl:Thing&#39;</span><span class="o">,</span> 
                <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">}</span>
            <span class="p">);</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">triple</span><span class="p">);</span>    
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>in any case, we query all connectors for the types of the entity.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">m</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;change:a&#39;</span><span class="p">);</span>
            <span class="p">};</span>
        <span class="p">}(</span><span class="nx">model</span><span class="p">));</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_remove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>when removing the model from this collection, that means
that we remove all corresponding data from the cache as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">entities</span> <span class="o">===</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>also remove from all other collections!</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">){</span>
                    <span class="nx">v</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
                <span class="p">});</span>
                
                <span class="nx">VIE</span><span class="p">.</span><span class="nx">EntityManager</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">VIE</span><span class="p">.</span><span class="nx">RDFEntityCollection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_remove</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
            <span class="nx">model</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">VIE2</span><span class="p">.</span><span class="nx">entities</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">EntityCollection</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p><strong>VIE2.ObjectCollection</strong>: TODO: document me</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">ObjectCollection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        
    <span class="nx">_add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>TODO: propagate event to parent model</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>adding a back-reference to the model</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">model</span><span class="p">.</span><span class="nx">collection</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_add</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">backend</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">triple</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">,</span> 
                <span class="k">this</span><span class="p">.</span><span class="nx">property</span><span class="o">,</span> 
                <span class="nx">model</span><span class="p">.</span><span class="nx">tojQueryRdf</span><span class="p">()</span><span class="o">,</span> 
                <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">}</span>
            <span class="p">);</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">triple</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="o">,</span>
    
     <span class="nx">_remove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>remove corresponding triples</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">removeFromCache</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">property</span><span class="o">,</span> <span class="nx">model</span><span class="p">.</span><span class="nx">tojQueryRdf</span><span class="p">());</span>
            
            <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_remove</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
             </pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>update parent entity</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span>
        <span class="p">}</span>
     <span class="p">}</span><span class="o">,</span>
     
     <span class="nx">getByValue</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>
         
         <span class="kd">var</span> <span class="nx">found</span><span class="o">;</span>
         <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
             <span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                 <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">lang</span><span class="p">)</span> <span class="p">{</span>
                     <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">lang</span> <span class="o">===</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;lang&#39;</span><span class="p">))</span> <span class="p">{</span>
                         <span class="nx">found</span> <span class="o">=</span> <span class="nx">model</span><span class="o">;</span>
                         <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                     <span class="p">}</span>
                 <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">datatype</span><span class="p">)</span> <span class="p">{</span>
                     <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">datatype</span> <span class="o">===</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;datatype&#39;</span><span class="p">))</span> <span class="p">{</span>
                         <span class="nx">found</span> <span class="o">=</span> <span class="nx">model</span><span class="o">;</span>
                         <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                     <span class="p">}</span>
                 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                     <span class="nx">found</span> <span class="o">=</span> <span class="nx">model</span><span class="o">;</span>
                     <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                 <span class="p">}</span>
             <span class="p">}</span>
         <span class="p">});</span>
         
         <span class="k">return</span> <span class="nx">found</span><span class="o">;</span>
     <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>File:   model.js
Author: <a href="mailto:sebastian.germesin@dfki.de">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p><strong>VIE2.Entity</strong>: The parent backbone entity class for all other entites.
Inherits from VIE.RDFEntity.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Entity</span> <span class="o">=</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">RDFEntity</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>if the type has changed, we need to search through the
mappings if the model needs to be inserted.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change:a&#39;</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">searchCollections</span><span class="p">);</span>  
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">backend</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">attr</span> <span class="k">in</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">attr</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span> <span class="o">!==</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">val</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">triple</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attr</span><span class="o">,</span> <span class="nx">val</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="p">{</span>
                                <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span>
                            <span class="p">});</span>
                            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">triple</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">triple</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">triple</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">attr</span><span class="o">,</span> <span class="nx">val</span><span class="o">,</span> <span class="p">{</span>
                            <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span>
                        <span class="p">});</span>
                        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">triple</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">searchCollections</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">getFromCache</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">,</span> <span class="s1">&#39;a&#39;</span><span class="p">);</span>
        
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">mappings</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">mapping</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">belongsHere</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">types</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">curie</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isCurie</span><span class="p">(</span><span class="nx">curie</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">curie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="nx">curie</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^&lt;/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;$/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">,</span> <span class="p">{</span>
                        <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span>
                        <span class="nx">charcase</span><span class="o">:</span> <span class="s1">&#39;lower&#39;</span>
                    <span class="p">}).</span><span class="nx">toString</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">mapping</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">curie</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">belongsHere</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="p">}</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>entity needs to be registered with this mapping</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">belongsHere</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>adding model instance to collection</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mapping</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">mapping</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">self</span><span class="o">,</span> <span class="p">{</span><span class="nx">backend</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Entity.searchCollections()&quot;</span><span class="o">,</span> <span class="s2">&quot;Added entity &#39;&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; to collection of type &#39;&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;&#39;!&quot;</span><span class="p">);</span>
                    
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Entity.searchCollections()&quot;</span><span class="o">,</span> <span class="s2">&quot;Querying for default properties for entity &#39;&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;: [&quot;</span> <span class="o">+</span> <span class="nx">mapping</span><span class="p">[</span><span class="s1">&#39;mapping&#39;</span><span class="p">].</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]!&quot;</span><span class="p">);</span>
                    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">,</span> <span class="nx">mapping</span><span class="p">[</span><span class="s1">&#39;mapping&#39;</span><span class="p">].</span><span class="nx">defaults</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">defProps</span><span class="o">,</span> <span class="nx">model</span><span class="p">){</span>
                        <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
                            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Entity.searchCollections()&quot;</span><span class="o">,</span> <span class="s2">&quot;Finished querying for default properties for entity &#39;&quot;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;: [&quot;</span> <span class="o">+</span> <span class="nx">defProps</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]!&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>trigger change when finished</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">defProps</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">model</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;change:&#39;</span> <span class="o">+</span> <span class="nx">defProps</span><span class="p">[</span><span class="nx">y</span><span class="p">]);</span>
                            <span class="p">}</span>
                            <span class="nx">model</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span>
                        <span class="p">};</span>
                    <span class="p">}(</span><span class="nx">mapping</span><span class="p">[</span><span class="s1">&#39;mapping&#39;</span><span class="p">].</span><span class="nx">defaults</span><span class="o">,</span> <span class="nx">self</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>overwritten to directly access the global Cache</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span> <span class="o">===</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">RDFEntity</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">attr</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">getFromCache</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">,</span> <span class="nx">attr</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">save</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">attrs</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">options</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="kd">var</span> <span class="nx">success</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span><span class="o">,</span> <span class="nx">options</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="nx">model</span><span class="o">,</span> <span class="nx">resp</span><span class="p">);</span>
            <span class="p">};</span>
        <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">noop</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">()</span> <span class="o">?</span> <span class="s1">&#39;create&#39;</span> <span class="o">:</span> <span class="s1">&#39;update&#39;</span><span class="o">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">method</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};}</span>
        
        <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">VIE</span><span class="p">.</span><span class="nx">EntityManager</span><span class="p">.</span><span class="nx">getBySubject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">removeFromCache</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">,</span> <span class="s1">&#39;?x&#39;</span><span class="o">,</span> <span class="s1">&#39;?y&#39;</span><span class="p">);</span>
            
            <span class="kd">var</span> <span class="nx">success</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">){</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> 
                    <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="nx">model</span><span class="o">,</span> <span class="nx">resp</span><span class="p">);</span>
            <span class="p">};</span>
            <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">noop</span><span class="o">;</span>
            <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span> <span class="o">||</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">sync</span><span class="p">)(</span><span class="s1">&#39;delete&#39;</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">sync</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">method</span><span class="o">,</span> <span class="nx">model</span><span class="o">,</span> <span class="nx">success</span><span class="o">,</span> <span class="nx">error</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Backbone#sync(&quot;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="o">,</span> <span class="s2">&quot;Start syncing!&quot;</span><span class="p">);</span>
        
        <span class="kd">var</span> <span class="nx">rdfTmp</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">({</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
        
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span>
        <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ?p ?o&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">bindings</span><span class="o">,</span> <span class="nx">trs</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">trs</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">rdfTmp</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">trs</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">rules</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">rdfTmp</span><span class="p">.</span><span class="nx">reason</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">rules</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>TODO: filter!</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span>
        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Backbone#sync(&quot;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="o">,</span> <span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="nx">triples</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; triples for serialization!&quot;</span><span class="p">);</span>
            
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">connectors</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">connector</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Backbone#sync(&quot;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="o">,</span> <span class="s2">&quot;Using connector: &#39;&quot;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
            <span class="nx">connector</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="nx">triples</span><span class="o">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="p">});</span>
        </pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>VIE.RDFEntity.prototype.sync.call(this, method, model, success, error);</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Backbone#sync(&quot;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="o">,</span> <span class="s2">&quot;End syncing!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">VIE2</span><span class="p">.</span><span class="nx">createEntity</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="k">in</span> <span class="nx">attrs</span><span class="p">))</span> <span class="p">{</span>
    	<span class="nx">attrs</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">blank</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">Entity</span><span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">model</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">model</span><span class="o">;</span>
<span class="p">};</span>

<span class="nx">VIE2</span><span class="p">.</span><span class="nb">Object</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};}</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">isLiteral</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">isLiteral</span><span class="o">;</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attrs</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        
        <span class="kd">var</span> <span class="nx">oldValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">newValue</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">oldValue</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">oldValue</span> <span class="o">!==</span> <span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>TODO: Dear future me! This is a hack, please change that!
user driven change
add the new</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">createLiteral</span><span class="p">(</span><span class="nx">newValue</span><span class="o">,</span> <span class="p">{</span>
                    <span class="nx">lang</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]</span><span class="o">,</span>
                    <span class="nx">datatype</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;datatype&#39;</span><span class="p">]</span>
                <span class="p">});</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">inst</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">change</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>remove the old one</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="p">}</span>   
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">attrs</span><span class="o">,</span> <span class="nx">opts</span><span class="p">);</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">tojQueryRdf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLiteral</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tojQueryRdfLit</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tojQueryRdfRes</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_tojQueryRdfLit</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">lang</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;lang&#39;</span><span class="p">))</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;lang&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">undefined</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">datatype</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;datatype&#39;</span><span class="p">))</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;datatype&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">undefined</span><span class="o">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">lang</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">datatype</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">datatype</span> <span class="o">=</span> <span class="kc">undefined</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">literal</span><span class="p">(</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="o">,</span> <span class="p">{</span>
                <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span>
                <span class="nx">datatype</span><span class="o">:</span> <span class="nx">datatype</span><span class="o">,</span>
                <span class="nx">lang</span><span class="o">:</span> <span class="nx">lang</span>
        <span class="p">});</span>
    <span class="p">}</span><span class="o">,</span>
    
    <span class="nx">_tojQueryRdfRes</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="o">,</span> <span class="p">{</span>
                <span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">VIE2</span><span class="p">.</span><span class="nx">createLiteral</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nb">Object</span><span class="p">({</span>
        <span class="nx">value</span><span class="o">:</span> <span class="nx">value</span><span class="o">,</span>
        <span class="nx">isResource</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
        <span class="nx">lang</span><span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">lang</span><span class="o">,</span>
        <span class="nx">datatype</span><span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">datatype</span><span class="o">,</span>
    <span class="p">}</span><span class="o">,</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">opts</span><span class="o">,</span> <span class="p">{</span><span class="nx">isLiteral</span><span class="o">:</span> <span class="kc">true</span><span class="p">}));</span>
<span class="p">};</span>

<span class="nx">VIE2</span><span class="p">.</span><span class="nx">createResource</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="o">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};}</span>
     <span class="k">return</span> <span class="k">new</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nb">Object</span><span class="p">({</span>
        <span class="nx">value</span><span class="o">:</span> <span class="nx">value</span><span class="o">,</span>
        <span class="nx">isLiteral</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
        <span class="nx">isResource</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span><span class="o">,</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">opts</span><span class="o">,</span> <span class="p">{</span><span class="nx">isLiteral</span><span class="o">:</span> <span class="kc">false</span><span class="p">}));</span>
<span class="p">};</span><span class="c">// File:   connector.js</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Author: <a href="mailto:sebastian.germesin@dfki.de">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>The Connector class.
So far, a connector has two main functionalities:
1. analyze: Applies semantic lifting of the passed object
2. query: Queries for properties of the given entity uri</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>A connector needs an <strong>id</strong> of type string and an optional
options object. The only option that is used in VIE&sup2; so far
is options['namespaces'], which adds connector-specific 
namespaces to VIE&sup2;. However, you may add other options,
specific for this connector here.
After registration, they can be changed with:</p>

<pre>
  VIE2.connectors['<id>'].options({...});
</pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Connector</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>A connector needs an id of type string.    </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">id</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;The connector constructor needs an &#39;id&#39; of type &#39;string&#39;!&quot;</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="o">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_options</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span><span class="o">?</span> <span class="nx">options</span> <span class="o">:</span> <span class="p">{};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>registers the connector within VIE&sup2;. Also adds the given namespaces
to the global cache in VIE&sup2;.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">registerConnector</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>setter and getter for options</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Connector</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">values</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>return the values</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_options</span><span class="p">[</span><span class="nx">values</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">values</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>extend options</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_options</span><span class="o">,</span> <span class="nx">values</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>get options</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_options</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>TODO: document me</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Connector</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">analyze</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">object</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Connector(&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;)#analyze()&quot;</span><span class="o">,</span> <span class="s2">&quot;Not overwritten!&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>TODO: document me</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Connector</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="o">,</span> <span class="nx">properties</span><span class="o">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Connector(&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;)#query()&quot;</span><span class="o">,</span> <span class="s2">&quot;Not overwritten!&quot;</span><span class="p">);</span>
    <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="p">{});</span>
<span class="p">};</span>

<span class="nx">VIE2</span><span class="p">.</span><span class="nx">Connector</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">serialize</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rdf</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;VIE2.Connector(&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;)#serialize()&quot;</span><span class="o">,</span> <span class="s2">&quot;Not overwritten!&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="p">{});</span>
    <span class="p">}</span>
<span class="p">};</span><span class="c">// File:   mapping.js</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Author: <a href="mailto:sebastian.germesin@dfki.de">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>A <code>Mapping</code> provides functionality to map cache knowledge
to Backbone models</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Mapping</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">types</span><span class="o">,</span> <span class="nx">defaults</span><span class="o">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;The mapping constructor needs an &#39;id&#39;!&quot;</span><span class="o">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">id</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;The mapping constructor needs an &#39;id&#39; of type &#39;string&#39;!&quot;</span><span class="o">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">types</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;The mapping constructor needs &#39;types&#39;!&quot;</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="o">;</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span><span class="o">?</span> <span class="nx">options</span> <span class="o">:</span> <span class="p">{};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>add given namespaces to VIE&sup2;'s namespaces</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
           <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="o">;</span>
           <span class="nx">VIE2</span><span class="p">.</span><span class="nx">globalCache</span><span class="p">.</span><span class="nx">prefix</span><span class="p">(</span><span class="nx">k</span><span class="o">,</span> <span class="nx">v</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>normalization to CURIEs (where needed)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">types</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">types</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">types</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isCurie</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^&lt;/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;$/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span> <span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="nx">charcase</span><span class="o">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">}).</span><span class="nx">toString</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>normalization to CURIEs (where needed)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">defaults</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isCurie</span><span class="p">(</span><span class="nx">d</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">d</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">createCurie</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^&lt;/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;$/</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span> <span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="o">,</span> <span class="nx">charcase</span><span class="o">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">}).</span><span class="nx">toString</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>automatically registers the mapping in VIE^2.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">VIE2</span><span class="p">.</span><span class="nx">registerMapping</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">};</span><span class="c">// File:   util.js</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Author: <a href="mailto:sebastian.germesin@dfki.de">Sebastian Germesin</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p><strong>VIE2.Util.(haystack, needle)</strong>: Removes the <em>needle</em> from the <em>haystack</em> array.<br>
<code>return void</code> </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">removeElement</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">haystack</span><span class="o">,</span> <span class="nx">needle</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>First we check if haystack is indeed an array.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">haystack</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>iterate over the array and check for equality.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">haystack</span><span class="o">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">haystack</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">===</span> <span class="nx">needle</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>remove the one element and</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">haystack</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>break the iteration.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p><strong>VIE2.Util.isCurie(str)</strong>: Checks whether the given string is a curie.<br>
<code>return boolean</code> </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isCurie</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">str</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^&lt;$/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">7</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^http:\/\/$/</span><span class="p">));</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p><strong>VIE2.Util.isLiteral(str)</strong>: Checks whether the given string is a literal.<br>
<code>return boolean</code> </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isLiteral</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span><span class="nx">str</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">blank</span><span class="p">(</span><span class="nx">str</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">literal</span><span class="p">(</span><span class="nx">str</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p><strong>VIE2.Util.isLiteral(str)</strong>: Checks whether the given string is a blank.<br>
<code>return boolean</code> </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">VIE2</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">isBlank</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span><span class="nx">str</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">rdf</span><span class="p">.</span><span class="nx">blank</span><span class="p">(</span><span class="nx">str</span><span class="o">,</span> <span class="p">{</span><span class="nx">namespaces</span><span class="o">:</span> <span class="nx">VIE2</span><span class="p">.</span><span class="nx">namespaces</span><span class="p">});</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>calling this once for convenience</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">vie2</span><span class="p">();</span>


<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 