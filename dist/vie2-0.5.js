Connector=function(b,a){if(b===undefined){throw"The connector constructor needs an 'id'!"}if(typeof b!=="string"){throw"The connector constructor needs an 'id' of type 'string'!"}this.id=b;this._options=(a)?a:{};jQuery.VIE2.registerConnector(this)};Connector.prototype.options=function(a){if(a){jQuery.extend(true,this._options,a)}else{return this._options}};Connector.prototype.analyze=function(a,b){jQuery.VIE2.log("info","VIE2.Connector("+this.id+")","Not implemented: analyze();");b(jQuery.rdf())};Connector.prototype.query=function(b,a,c,d){jQuery.VIE2.log("info","VIE2.Connector("+this.id+")","Not implemented: query();");d({})};Mapping=function(b,a){if(b===undefined){throw"The mapping constructor needs an 'id'!"}if(typeof b!=="string"){throw"The mapping constructor needs an 'id' of type 'string'!"}this.id=b;this._options=(a)?a:{};jQuery.VIE2.registerMapping(this)};Mapping.prototype.options=function(a){if(a){jQuery.extend(true,this._options,a)}else{return this._options}};Mapping.prototype.mapto=function(d,g){if(this.options().mapping){var e=this;var f=this.options().mapping;var c=[];var b=d.filter(this.options()["a"]);var a=[];jQuery.each(b,function(h){var j=b[h];jQuery.each(f,function(l,i){var m=(jQuery.isArray(i))?i:[i];jQuery.each(m,function(k){var o=m[k];var n=j+"||"+o;a.push(n)})})});jQuery.each(b,function(h){var j=b[h];var k={a:e.id,jsonld:{"#":d.options.namespaces,"@":j.toString(),a:[]}};c.push(k);jQuery.each(f,function(l,i){k[l]=[];var m=(jQuery.isArray(i))?i:[i];jQuery.each(m,function(n){var p=m[n];k.jsonld[p]=[];var o=j+"||"+p;d.query(j,p,function(q,t,r,u){return function(){var s=this[u];jQuery.merge(t[r],s);jQuery.merge(t.jsonld[u],s);removeElement(a,q);if(a.length===0){g.call(c)}}}(o,k,l,p))})})})}else{g({})}};(function(a,b){a.widget("VIE2.vie2",{options:{namespaces:{dbpedia:"http://dbpedia.org/resource/",dbprop:"http://dbpedia.org/property/",dbonto:"http://dbpedia.org/ontology/",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",iks:"http://www.iks-project.eu/#",fise:"http://fise.iks-project.eu/ontology/",foaf:"http://xmlns.com/foaf/0.1/",dc:"http://purl.org/dc/terms/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",google:"http://rdf.data-vocabulary.org/#"},_context:{},_cache:jQuery.rdf(),_matches:[],_oldMatches:[]},_create:function(){var c=this;this.options._cache=jQuery.rdf();jQuery.each(this.options.namespaces,function(e,d){c.options._cache.prefix(e,d)})},_setOption:function(c,d){if(c==="namespaces"){jQuery.extend(true,this.options.namespaces,d);jQuery.each(this.options.namespaces,function(f,e){this.options._cache.prefix(f,e)})}else{jQuery.Widget.prototype._setOption.apply(this,[c,d])}},analyze:function(e){jQuery.VIE2.log("info","VIE2.core","Start: analyze()!");var d=this;var c=[];jQuery.each(jQuery.VIE2.connectors,function(){c.push(this.id)});jQuery.each(jQuery.VIE2.connectors,function(){var f=function(h,g){return function(i){jQuery.each(h.options.namespaces,function(l,j){i.prefix(l,j);h.options._cache.prefix(l,j)});i.databank.triples().each(function(){h.options._cache.add(this)});jQuery.each(i.databank.subjectIndex,function(l,j){var k=[];i.where(l+" a ?type").each(function(){k.push(this.type)});jQuery.VIE2.entities.add({id:l,a:k})});h.options._context[g.id]=i;jQuery.VIE2.log("info","VIE2.core","Received RDF annotation from connector '"+g.id+"'!");removeElement(c,g.id);if(c.length===0){jQuery.VIE2.log("info","VIE2.core","Finished task: 'analyze()'! Cache holds now "+d.options._cache.databank.tripleStore.length+" triples!");e.call(d.element)}}}(d,this);jQuery.VIE2.log("info","VIE2.core","Starting analysis with connector: '"+this.id+"'!");this.analyze(d.element,f)})},filter:function(c){if(c===b){jQuery.VIE2.log("warn","VIE2.core","Invoked 'filter()' with undefined argument!")}else{if(typeof c==="string"||jQuery.isArray(c)){return this.filter({a:c})}else{var d=this;d.options._oldMatches=d.options._matches;d.options._matches=[];jQuery.each(c,function(f,e){e=(jQuery.isArray(e))?e:[e];jQuery.each(e,function(g){var h=e[g];d.options._cache.where("?subject "+f+" "+h).each(function(){d.options._matches.push(this.subject)})})});return d.options._matches}}},query:function(j,g,k,d){var c={};if(j===b||g===b){jQuery.VIE2.log("warn","VIE2.core","Invoked 'query()' with undefined argument(s)!");k(c);return}else{if(typeof g==="string"){this.query(j,[g],k,d);return}}if((j instanceof jQuery.rdf.blank||(j instanceof jQuery.rdf.resource&&j.type==="uri")||typeof j==="string")&&jQuery.isArray(g)){var h=this;for(var e=0;e<g.length;e++){c[g[e]]=[]}if(!d||(d&&!d.cache==="nocache")){for(var e=0;e<g.length;e++){h.options._cache.where(jQuery.rdf.pattern(j,g[e],"?object",{namespaces:h.options.namespaces})).each(function(){c[g[e]].push(this.object)})}}if(d&&d.cache==="cacheonly"){k(c);return}var f=[];jQuery.each(jQuery.VIE2.connectors,function(){f.push(this.id)});jQuery.each(jQuery.VIE2.connectors,function(){jQuery.VIE2.log("info","VIE2.core","Start 'query()' with connector '"+this.id+"' for uri '"+j+"'!");var i=function(q,n,m,o,l,p){return function(r){jQuery.VIE2.log("info","VIE2.core","Received query information from connector '"+n.id+"' for uri '"+m+"'!");jQuery.extend(true,l,r);removeElement(f,n.id);if(f.length===0){jQuery.each(l,function(t,s){for(var u=0;u<s.length;u++){h.options._cache.add(jQuery.rdf.triple(m,t,s[u],{namespaces:o}))}});jQuery.VIE2.log("info","VIE2.core","Finished task: 'query()' for uri '"+m+"'! Cache holds now "+h.options._cache.databank.tripleStore.length+" triples!");p.call(l)}}}(h,this,j,h.options.namespaces,c,k);this.query(j,g,h.options.namespaces,i)})}else{k(c)}},mapto:function(c,d){if(jQuery.VIE2.getMapping(c)){jQuery.VIE2.log("info","VIE2.core","Start 'mapto()' with mapping '"+c+"'!");jQuery.VIE2.getMapping(c).mapto(this,d)}else{jQuery.VIE2.log("warn","VIE2.core","Could not find mapping with id '"+c+"'!")}},matches:function(){return this.options._matches},context:function(c){if(this.options._context[c]){return this.options._context[c]}},undo:function(){this.options._matches=this.options._oldMatches;this.options._oldMatches=[];return this},clear:function(){this.options._matches=[];this.options._oldMatches=[];this.options._context={};this.options._cache=jQuery.rdf();return this}})}(jQuery));jQuery.VIE2.log=function(c,a,b){switch(c){case"info":console.info(a+" "+b);break;case"warn":console.warn(a+" "+b);break;case"error":console.error(a+" "+b);break}};jQuery.VIE2.Backbone={};jQuery.VIE2.Entity=Backbone.Model.extend({});jQuery.VIE2.EntitiesCollection=Backbone.Collection.extend({model:jQuery.VIE2.Entity});jQuery.VIE2.entities=new jQuery.VIE2.EntitiesCollection;jQuery.VIE2.entities.bind("add",function(a){jQuery.VIE2.log("info","VIE2.core","Added entity '"+a.get("id")+"' to entities collection!");jQuery.each(jQuery.VIE2.Backbone,function(b,c){if(jQuery.inArray(a.get("a"),c.a)){jQuery.VIE2.log("info","VIE2.core","Added entity '"+a.get("id")+"' to collection of type '"+b+"'!")}})});jQuery.VIE2.connectors=[];jQuery.VIE2.registerConnector=function(a){var b=true;jQuery.each(jQuery.VIE2.connectors,function(){if(this.id===a.id){b=false;return false}});if(b){jQuery.VIE2.connectors.push(a);jQuery.VIE2.log("info","VIE2.core","Registered connector '"+a.id+"'")}else{jQuery.VIE2.log("warn","VIE2.core","Did not register connector, as there isalready a connector with the same id registered.")}};jQuery.VIE2.getConnector=function(b){var a=null;jQuery.each(jQuery.VIE2.connectors,function(){if(this.id===b){a=this;return false}});return a};jQuery.VIE2.unregisterConnector=function(b){var a=null;jQuery.each(jQuery.VIE2.connectors,function(){if(this.id===b){jQuery.VIE2.connectors.splice(index,1);jQuery.VIE2.log("info","VIE2.core","De-registered connector '"+a.id+"'");a=this;return false}});return a};jQuery.VIE2.mappings=[];jQuery.VIE2.registerMapping=function(b){var d=true;jQuery.each(jQuery.VIE2.mappings,function(){if(this.id===b.id){d=false;return}});if(d){jQuery.VIE2.log("info","VIE2.core","Registered mapping '"+b.id+"'");jQuery.VIE2.mappings.push(b);var c={};jQuery.each(b._options.mapping,function(g,f){c[g]=[]});var a=jQuery.VIE2.Entity.extend(c);var e=Backbone.Collection.extend({model:a});jQuery.VIE2.Backbone[b.id]={a:(jQuery.isArray(b._options.a))?b._options.a:[b._options.a],model:a,collection:e};jQuery.VIE2.log("info","VIE2.core","Registered mapping '"+b.id+"' finished!")}else{jQuery.VIE2.log("warn","VIE2.core","Did not register mapping, as there isalready a mapping with the same id registered.")}};jQuery.VIE2.getMapping=function(b){var a=null;jQuery.each(jQuery.VIE2.mappings,function(){if(this.id===b){a=this;return false}});return a};jQuery.VIE2.unregisterMapping=function(b){var a=null;jQuery.each(jQuery.VIE2.mappings,function(c){if(this.id===b){jQuery.VIE2.mappings.splice(c,1);jQuery.VIE2.log("info","VIE2.core","De-registered mapping '"+a.id+"'");a=this;return}});return a};function removeElement(a,b){if(jQuery.isArray(a)){jQuery.each(a,function(c){if(a[c]===b){a.splice(c,1);return false}})}};