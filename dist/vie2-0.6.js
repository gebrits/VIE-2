Connector=function(b,a){if(b===undefined){throw"The connector constructor needs an 'id'!"}if(typeof b!=="string"){throw"The connector constructor needs an 'id' of type 'string'!"}this.id=b;this._options=(a)?a:{};jQuery.VIE2.registerConnector(this)};Connector.prototype.options=function(a){if(a){jQuery.extend(true,this._options,a)}else{return this._options}};Connector.prototype.analyze=function(a,b){jQuery.VIE2.log("info","VIE2.Connector("+this.id+")#analyze()","Not overwritten!");b(jQuery.rdf())};Connector.prototype.query=function(b,a,c,d){jQuery.VIE2.log("info","VIE2.Connector("+this.id+")#query()","Not overwritten!");d({})};Connector.prototype.annotate=function(a,c,b,d){jQuery.VIE2.log("info","VIE2.Connector("+this.id+")#annotate()","Not overwritten!");d({})};Connector.prototype.remove=function(a,c,b,d){jQuery.VIE2.log("info","VIE2.Connector("+this.id+")#remove()","Not overwritten!");d({})};Mapping=function(c,a,b){if(c===undefined){throw"The mapping constructor needs an 'id'!"}if(typeof c!=="string"){throw"The mapping constructor needs an 'id' of type 'string'!"}if(a===undefined){throw"The mapping constructor needs 'types'!"}this.id=c;this.types=a;this.defaultProps=(b)?b:[];jQuery.VIE2.registerMapping(this)};(function(a,b){a.widget("VIE2.vie2",{options:{namespaces:{vie2:"http://vie2/property/"},_globalContext:jQuery.rdf(),_localContext:{}},_create:function(){var c=this;this.options._globalContext=jQuery.rdf();jQuery.each(jQuery("html").xmlns(),function(e,d){c.options.namespaces[e]=d.toString()});jQuery.each(this.options.namespaces,function(e,d){c.options._globalContext.prefix(e,d)})},_setOption:function(c,d){if(c==="namespaces"){jQuery.extend(true,this.options.namespaces,d);jQuery.each(this.options.namespaces,function(f,e){this.options._globalContext.prefix(f,e)})}else{jQuery.Widget.prototype._setOption.apply(this,[c,d])}},analyze:function(f,g){if(f===b){jQuery.VIE2.log("warn","VIE2.core#analyze()","No element specified, returning without action!");g.call(f);return}if(g===b){jQuery.VIE2.log("warn","VIE2.core#analyze()","No callback specified, returning without action!");g.call(f);return}if(!f.attr("id")){jQuery.VIE2.log("warn","VIE2.core#analyze()","No element id specified, generate one dynamically and add it!");var c=PseudoGuid.GetNew();jQuery.VIE2.log("warn","VIE2.core#analyze()","Generated id: '"+c+"'!");f.attr("id",c)}jQuery.VIE2.log("info","VIE2.core#analyze()","Start.");this.options._localContext[f.attr("id")]=jQuery.rdf();var e=this;var d=[];jQuery.each(jQuery.VIE2.connectors,function(){d.push(this.id)});jQuery.each(jQuery.VIE2.connectors,function(){var h=function(i,k,j){return function(l){jQuery.VIE2.log("info","VIE2.core#analyze()","Received RDF annotation from connector '"+k.id+"'!");jQuery.each(i.options.namespaces,function(n,m){l.prefix(n,m);i.options._globalContext.prefix(n,m)});l.databank.triples().each(function(){i.options._globalContext.add(this);e.options._localContext[j.attr("id")].add(this)});jQuery.each(l.databank.subjectIndex,function(o,m){var n=[];l.where(o+" a ?type").each(function(){n.push(this.type)});jQuery.VIE2.addBBEntity({id:o,a:n})});removeElement(d,k.id);if(d.length===0){jQuery.VIE2.log("info","VIE2.core#analyze()","Finished! Cache holds now "+e.options._globalContext.databank.triples().length+" triples!");g.call(j)}}}(e,this,f);jQuery.VIE2.log("info","VIE2.core#analyze()","Starting analysis with connector: '"+this.id+"'!");this.analyze(f,h)})},annotate:function(e,f){if(e!==b&&!e.attr("id")){jQuery.VIE2.log("warn","VIE2.core#annotate()","No element id specified, generate one dynamically and add it!");var c=PseudoGuid.GetNew();jQuery.VIE2.log("warn","VIE2.core#annotate()","Generated id: '"+c+"'!");e.attr("id",c)}if(f===b){jQuery.VIE2.log("warn","VIE2.core#annotate()","No triple specified, returning without action!");return this}if(!jQuery.isArray(f)){return this.annotate(e,[f])}jQuery.VIE2.log("info","VIE2.core#annotate()","Start.");var d=this;jQuery.each(f,function(h,g){var j=f[h];if(typeof j==="string"){j=jQuery.rdf.triple(j,{namespaces:d.options.namespaces})}d.options._globalContext.add(j);if(e!==b){if(!d.options._localContext[e.attr("id")]){d.options._localContext[e.attr("id")]=jQuery.rdf()}d.options._localContext[e.attr("id")].add(j)}jQuery.each(jQuery.VIE2.connectors,function(){var i=function(k,m,l,n){return function(){}}(d,this,e,j);this.annotate(e,j,d.options.namespaces,i)});jQuery.each(jQuery.VIE2.Backbone,function(l,i){var o=this;var n=o.collection.get(j.subject.toString());if(n){var m=j.property.toString();n.set({key:j.object});jQuery.VIE2.log("info","VIE2.core#annotate()","Added value to entity '"+n.id+"' '"+m+"' '"+j.object.toString()+"'!")}});jQuery.VIE2.log("info","VIE2.core#annotate()","End. Cache holds now "+d.options._globalContext.databank.tripleStore.length+" triples!")});return this},filter:function(c){if(c===b){jQuery.VIE2.log("warn","VIE2.core","Invoked 'filter()' with undefined argument!");return[]}if(typeof c==="string"||jQuery.isArray(c)){return this.filter({a:c})}var d=this;var e=[];jQuery.each(c,function(g,f){f=(jQuery.isArray(f))?f:[f];jQuery.each(f,function(h){var i=f[h];d.options._globalContext.where("?subject "+g+" "+i).each(function(){e.push(this.subject)})})});return e},query:function(j,g,k,d){var c={};jQuery.VIE2.log("info","VIE2.core#query()","Start!");if(j===b||g===b){jQuery.VIE2.log("warn","VIE2.core","Invoked 'query()' with undefined argument(s)!");k(c);return}else{if(typeof g==="string"){this.query(j,[g],k,d);return}}if((j instanceof jQuery.rdf.blank||(j instanceof jQuery.rdf.resource&&j.type==="uri")||typeof j==="string")&&jQuery.isArray(g)){var h=this;for(var e=0;e<g.length;e++){c[g[e]]=[]}if(!d||(d&&!d.cache==="nocache")){for(var e=0;e<g.length;e++){h.options._globalContext.where(jQuery.rdf.pattern(j,g[e],"?object",{namespaces:h.options.namespaces})).each(function(){c[g[e]].push(this.object)})}}if(d&&d.cache==="cacheonly"){k(c);return}var f=[];jQuery.each(jQuery.VIE2.connectors,function(){f.push(this.id)});jQuery.each(jQuery.VIE2.connectors,function(){jQuery.VIE2.log("info","VIE2.core","Start 'query()' with connector '"+this.id+"' for uri '"+j+"'!");var i=function(q,n,m,o,l,p){return function(r){jQuery.VIE2.log("info","VIE2.core","Received query information from connector '"+n.id+"' for uri '"+m+"'!");jQuery.extend(true,l,r);removeElement(f,n.id);if(f.length===0){jQuery.each(l,function(t,s){for(var u=0;u<s.length;u++){h.options._globalContext.add(jQuery.rdf.triple(m,t,s[u],{namespaces:o}))}});jQuery.VIE2.log("info","VIE2.core","Finished task: 'query()' for uri '"+m+"'! Cache holds now "+h.options._globalContext.databank.tripleStore.length+" triples!");p.call(l)}}}(h,this,j,h.options.namespaces,c,k);this.query(j,g,h.options.namespaces,i)})}else{k(c)}},mapto:function(c,d){if(jQuery.VIE2.mappings[c]){jQuery.VIE2.log("info","VIE2.core","Start 'mapto()' with mapping '"+c+"'!");jQuery.VIE2.mappings[c].mapto(this,d)}else{jQuery.VIE2.log("warn","VIE2.core","Could not find mapping with id '"+c+"'!")}},clear:function(){this.options._localConext={};this.options._globalContext=jQuery.rdf();return this}})}(jQuery));jQuery.VIE2.log=function(c,a,b){switch(c){case"info":console.info(a+" "+b);break;case"warn":console.warn(a+" "+b);break;case"error":console.error(a+" "+b);break}};jQuery.VIE2.Backbone={};jQuery.VIE2.Entity=Backbone.Model.extend({get:function(a){return VIE2.vie2("query",this.id,a)}});jQuery.VIE2.addBBEntity=function(a){jQuery.each(jQuery.VIE2.Backbone,function(b,c){jQuery.each(c.a,function(){if(jQuery.inArray(this,a.a)){belongsHere=true;return false}});if(belongsHere){c.collection.add(a);jQuery.VIE2.log("info","VIE2.core","Added entity '"+a.id+"' to collection of type '"+b+"'!")}})};jQuery.VIE2.connectors={};jQuery.VIE2.registerConnector=function(a){if(!jQuery.VIE2.connectors[a.id]){jQuery.VIE2.connectors[a.id]=a;jQuery.VIE2.log("info","VIE2.core","Registered connector '"+a.id+"'")}else{jQuery.VIE2.log("warn","VIE2.core","Did not register connector, as there isalready a connector with the same id registered.")}};jQuery.VIE2.unregisterConnector=function(a){jQuery.VIE2.connectors[connector.id]=undefined};jQuery.VIE2.mappings={};jQuery.VIE2.registerMapping=function(b){if(!jQuery.VIE2.mappings[b.id]){jQuery.VIE2.log("info","VIE2.core","Registered mapping '"+b.id+"'");jQuery.VIE2.mappings[b.id,b];var d={};jQuery.each(b.defaultProps,function(e){d[b.defaultProps[e]]=undefined});var a=jQuery.VIE2.Entity.extend(d);var c=Backbone.Collection.extend({model:a});jQuery.VIE2.Backbone[b.id]={a:(jQuery.isArray(b.types))?b.types:[b.types],model:a,collection:new c()};jQuery.VIE2.log("info","VIE2.core","Registered mapping '"+b.id+"' finished!")}else{jQuery.VIE2.log("warn","VIE2.core","Did not register mapping, as there isalready a mapping with the same id registered.")}};jQuery.VIE2.unregisterMapping=function(a){jQuery.VIE2.mappings[a]=undefined};$(window).load(function(){VIE2=$(document).vie2()});function removeElement(a,b){if(jQuery.isArray(a)){jQuery.each(a,function(c){if(a[c]===b){a.splice(c,1);return false}})}}var PseudoGuid=new (function(){this.empty="VIE2-00000000-0000-0000-0000-000000000000";this.GetNew=function(){var a=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1).toUpperCase()};return("VIE2-"+a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())}})();