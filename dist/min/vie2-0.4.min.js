Connector=function(b,a){this.id=b;this.options=a;$.VIE2.registerConnector(this)};Connector.prototype.init=function(){};Connector.prototype.analyze=function(a,b,c){$.VIE2.log("info","VIE^2.Connector("+this.id+")","Not implemented: analyze();")};Connector.prototype.query=function(b,a){$.VIE2.log("info","VIE^2.Connector("+this.id+")","Not implemented: query();")};Mapping=function(b,a){if(b===undefined){throw"The mapping constructor needs an 'id'!"}if(typeof b!=="string"){throw"The mapping constructor needs an 'id' of type 'string'!"}this.id=b;this.options=a;$.VIE2.registerMapping(this)};Mapping.prototype.filter=function(b,a,d){var e=[];var c=this;jQuery.each(a,function(g,f){if(c.options.mapping.type[g]){f.where("?subject "+c.options.mapping.type[g].type+" "+c.options.mapping.type[g].value).each(function(){var h={};var i=this.subject;var j=f.databank.subjectIndex[i];jQuery.each(c.options.mapping,function(k,m){if(k!=="type"){if(k==="*"){}else{h[k]=[];var l=m[g];if(l){if(typeof l==="string"){l=[l]}if(jQuery.isArray(l)){jQuery.each(l,function(o,n){var q=jQuery.rdf.resource(n,{namespaces:f.databank.namespaces});jQuery.each(j,function(){if(this.property===q){h[k].push(this.object)}});if(h[k].length===0){var p=b.query(i,[q]);if(p[q]){jQuery.extend(h[k],p[q])}}})}}}}});e.push(h)})}});return e};(function(a,b){a.widget("VIE2.vie2",{options:{namespaces:{dbpedia:"http://dbpedia.org/resource/",dbprop:"http://dbpedia.org/property/",dbonto:"http://dbpedia.org/ontology/",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",iks:"http://www.iks-project.eu/#",fise:"http://fise.iks-project.eu/ontology/",foaf:"http://xmlns.com/foaf/0.1/",dc:"http://purl.org/dc/terms/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#"},contextchanged:jQuery.noop},_context:{},_matches:[],_oldMatches:[],_create:function(){jQuery.VIE2.log("info","VIE2.core","Start "+this.element);jQuery.VIE2.log("info","VIE2.core","End "+this.element)},analyze:function(f,d){jQuery.VIE2.log("info","VIE2.core","Start analyze!");var e=this;var c=[];jQuery.each(jQuery.VIE2.connectors,function(){c.push(this.id);jQuery.VIE2.log("info","VIE2.core","Starting analysis with connector: '"+this.id+"'!");var g=function(i,h){return function(j){jQuery.each(i.options.namespaces,function(m,l){j.prefix(m,l)});i._context[h.id]=j;jQuery.VIE2.log("info","VIE2.core","Received RDF annotation from connector '"+h.id+"'!");removeElement(c,h.id);if(c.length===0){jQuery.VIE2.log("info","VIE2.core","Finished task: 'analyze'!");e._trigger("contextchanged",null,{});f.call(e.element)}}}(e,this);this.analyze(e.element,e.options.namespaces,g)})},filter:function(c){if(c===b){jQuery.VIE2.log("warn","VIE2.core","Invoked 'filter' with undefined argument!");return[]}else{if(typeof c==="string"){var e=this;this._oldMatches=this._matches;this._matches=[];var d=false;var f=[];a.each(jQuery.VIE2.mappings,function(){if(this.id===c){d=true;jQuery.VIE2.log("info","VIE2.core","Invoking mapping '"+this.id+"'!");f=this.filter(e,e._context,e._oldMatches);e._matches=f}});if(!d){jQuery.VIE2.log("warn","VIE2.core","filer(): Found no mapping with name '"+c+"'!");return[]}else{return f}}else{jQuery.VIE2.log("warn","VIE2.core","Invoked 'filter' with wrong argument: '"+c+"'!");return[]}}},query:function(f,d){var c={};if(f===b){jQuery.VIE2.log("warn","VIE2.core","Invoked 'query' with undefined argument!")}if(f instanceof jQuery.rdf.resource&&f.type==="uri"){var e=this;jQuery.each(d,function(){c[this]=[]});jQuery.each(jQuery.VIE2.connectors,function(){var g=this.query(f,d);if(g){jQuery.extend(c,g)}})}return c},matches:function(){return this._matches},context:function(c){if(this._context[c]){return this._context[c]}},undo:function(){this._matches=this._oldMatches;this._oldMatches=[];return this},clear:function(){this._matches=[];this._oldMatches=[];this._context={};return this}})}(jQuery));jQuery.VIE2.log=function(c,a,b){switch(c){case"info":console.info(a+" "+b);break;case"warn":console.warn(a+" "+b);break;case"error":console.error(a+" "+b);break}};jQuery.VIE2.connectors=[];jQuery.VIE2.registerConnector=function(a){var b=true;jQuery.each(jQuery.VIE2.connectors,function(){if(this.id===a.id){b=false;return false}});if(b){jQuery.VIE2.connectors.push(a);jQuery.VIE2.log("info","VIE2.core","Registered connector '"+a.id+"'")}else{jQuery.VIE2.log("warn","VIE2.core","Did not register connector, as there isalready a connector with the same id registered.")}};jQuery.VIE2.unregisterConnector=function(a){jQuery.each(jQuery.VIE2.connectors,function(){if(this.id===a.id){jQuery.VIE2.connectors.splice(index,1);jQuery.VIE2.log("info","VIE2.core","De-registered connector '"+a.id+"'");return false}})};jQuery.VIE2.mappings=[];jQuery.VIE2.registerMapping=function(a){var b=true;jQuery.each(jQuery.VIE2.mappings,function(){if(this.id===a.id){b=false;return}});if(b){jQuery.VIE2.mappings.push(a);jQuery.VIE2.log("info","VIE2.core","Registered mapping '"+a.id+"'")}else{jQuery.VIE2.log("warn","VIE2.core","Did not register mapping, as there isalready a mapping with the same id registered.")}};jQuery.VIE2.unregisterMapping=function(a){jQuery.each(jQuery.VIE2.mappings,function(b){if(this.id===a.id){jQuery.VIE2.mappings.splice(b,1);jQuery.VIE2.log("info","VIE2.core","De-registered mapping '"+a.id+"'");return}})};var JSONLDEntity=function(f,e,d,b){var c={"#":f,"@":e,a:d};for(var a in b){c[a]=b[a]}return c};function removeElement(a,b){if(jQuery.isArray(a)){jQuery.each(a,function(c){if(a[c]===b){a.splice(c,1);return false}})}};