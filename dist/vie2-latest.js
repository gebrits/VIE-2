if(typeof VIE2=="undefined"||!VIE2){VIE2={}}if(typeof VIE2.Util=="undefined"||!VIE2.Util){VIE2.Util={}}VIE2.Util.removeElement=function(a,b){if(jQuery.isArray(a)){jQuery.each(a,function(c){if(a[c]===b){a.splice(c,1);return false}})}};VIE2.Util.PseudoGuid=new (function(){this.empty="VIE2-00000000-0000-0000-0000-000000000000";this.GetNew=function(){var a=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1).toUpperCase()};return("VIE2-"+a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())}})();VIE2.Util.isCurie=function(a){return !a.substring(0,1).match(/^<$/)&&!(a.substring(0,7).match(/^http:\/\/$/))};VIE2.Util.isLiteral=function(d){try{$.rdf.resource(d,{namespaces:VIE2.namespaces});return false}catch(c){try{$.rdf.blank(d,{namespaces:VIE2.namespaces});return false}catch(b){try{$.rdf.literal(d,{namespaces:VIE2.namespaces});return true}catch(a){return false}}}};VIE2.Util.isBlank=function(c){try{$.rdf.resource(c,{namespaces:VIE2.namespaces});return false}catch(b){try{$.rdf.blank(c,{namespaces:VIE2.namespaces});return true}catch(a){return false}}};if(typeof VIE2=="undefined"||!VIE2){VIE2={}}VIE2.Connector=function(b,a){if(b===undefined||typeof b!=="string"){throw"The connector constructor needs an 'id' of type 'string'!"}this.id=b;this._options=(a)?a:{};VIE2.registerConnector(this)};VIE2.Connector.prototype.options=function(a){if(typeof a==="string"){return this._options[a]}else{if(typeof a==="object"){jQuery.extend(true,this._options,a)}else{return this._options}}};VIE2.Connector.prototype.analyze=function(b,a){VIE2.log("info","VIE2.Connector("+this.id+")#analyze()","Not overwritten!");if(a&&a.success){a.success.call(this,jQuery.rdf())}};VIE2.Connector.prototype.query=function(b,a,c){VIE2.log("info","VIE2.Connector("+this.id+")#query()","Not overwritten!");c.call(this,{})};if(typeof VIE2=="undefined"||!VIE2){VIE2={}}VIE2.Mapping=function(h,c,f,a){if(h===undefined){throw"The mapping constructor needs an 'id'!"}if(typeof h!=="string"){throw"The mapping constructor needs an 'id' of type 'string'!"}if(c===undefined){throw"The mapping constructor needs 'types'!"}this.id=h;this.options=(a)?a:{};if(this.options.namespaces){jQuery.each(this.options.namespaces,function(i,d){VIE2.namespaces[i]=d;VIE2.globalCache.prefix(i,d)})}this.types=[];for(var b=0;b<c.length;b++){var e=c[b];if(!VIE2.Util.isCurie(e)){e=jQuery.createCurie(e.replace(/^</,"").replace(/>$/,""),{namespaces:VIE2.namespaces,charcase:"lower"}).toString()}this.types.push(e)}this.defaults=[];for(var b=0;b<f.length;b++){var g=f[b];if(!VIE2.Util.isCurie(g)){g=jQuery.createCurie(g.replace(/^</,"").replace(/>$/,""),{namespaces:VIE2.namespaces,charcase:"lower"}).toString()}this.defaults.push(g)}VIE2.registerMapping(this)};if(typeof VIE2=="undefined"||!VIE2){VIE2={}}VIE.EntityManager.initializeCollection();VIE2.EntityCollection=VIE.RDFEntityCollection.extend({_add:function(a,b){if(!b){b={}}VIE.RDFEntityCollection.prototype._add.call(this,a,b);if(!b.backend){var c=jQuery.rdf.triple(a.get("id"),"a","owl:Thing",{namespaces:VIE2.namespaces});VIE2.globalCache.add(c)}VIE2.lookup(a.get("id"),["a"],function(d){return function(){d.trigger("change:a")}}(a))},_remove:function(a,b){if(!b){b={}}var c=jQuery.rdf.pattern(a.get("id"),"?x","?y",{namespaces:VIE2.namespaces});VIE2.globalCache.remove(c);VIE.RDFEntityCollection.prototype._remove.call(this,models,b)}});VIE2.entities=new VIE2.EntityCollection();VIE2.ObjectCollection=Backbone.Collection.extend({_add:function(a,b){if(!b){b={}}Backbone.Collection.prototype._add.call(this,a,b);if(!b.backend){var c=jQuery.rdf.triple(this.uri,this.property,a.tojQueryRdf(),{namespaces:VIE2.namespaces});VIE2.globalCache.add(c)}},_remove:function(a,b){}});if(typeof VIE2=="undefined"||!VIE2){VIE2={}}VIE2.Entity=VIE.RDFEntity.extend({initialize:function(b,d){this.bind("change:a",this.searchCollections);if(!d){d={}}if(!d.backend){for(var a in b){var f=b[a];if(a!=="id"){if($.isArray(f)){for(var c=0;c<f.length;c++){var e=jQuery.rdf.triple(this.id,a,f[c],{namespaces:VIE2.namespaces});VIE2.globalCache.add(e)}}else{var e=jQuery.rdf.triple(this.id,a,f,{namespaces:VIE2.namespaces});VIE2.globalCache.add(e)}}}}},searchCollections:function(){var a=this;var b=VIE2.getFromCache(this.get("id"),"a");jQuery.each(VIE2.mappings,function(e,d){var g=false;for(var c=0;c<b.length;c++){var f=b.at(c).get("value");if(!VIE2.Util.isCurie(f)){f=jQuery.createCurie(f.replace(/^</,"").replace(/>$/,""),{namespaces:VIE2.namespaces,charcase:"lower"}).toString()}if(d.a.indexOf(f)!==-1){g=true;break}}if(g){if(!d.collection.get(a.id)){d.collection.add(a,{backend:true});VIE2.log("info","VIE2.Entity.searchCollections()","Added entity '"+a.get("id")+"' to collection of type '"+e+"'!");VIE2.log("info","VIE2.Entity.searchCollections()","Querying for default properties for entity '"+a.get("id")+"': ["+d.mapping.defaults.join(", ")+"]!");VIE2.lookup(a.get("id"),d.mapping.defaults,function(i,h){return function(){VIE2.log("info","VIE2.Entity.searchCollections()","Finished querying for default properties for entity '"+h.get("id")+"': ["+i.join(", ")+"]!");for(var j=0;j<i.length;j++){h.trigger("change:"+i[j])}h.change()}}(d.mapping.defaults,a))}}})},get:function(a){if(a==="id"){return VIE.RDFEntity.prototype.get.call(this,a)}return VIE2.getFromCache(this.get("id"),a)}});VIE2.Literal=Backbone.Model.extend({set:function(a,b){return Backbone.Model.prototype.set.call(this,a,b)},tojQueryRdf:function(){var b=(this.get("lang"))?this.get("lang"):undefined;var a=(this.get("datatype"))?this.get("datatype"):undefined;if(b!==undefined&&a!==undefined){a=undefined}return jQuery.rdf.literal(this.get("value"),{namespaces:VIE2.namespaces,datatype:a,lang:b})}});VIE2.Resource=Backbone.Model.extend({set:function(a,b){return Backbone.Model.prototype.set.call(this,a,b)},tojQueryRdf:function(){return jQuery.rdf.resource(this.get("value"),{namespaces:VIE2.namespaces})}});(function(a,b){a.widget("VIE2.vie2",{options:{entities:[]},_create:function(){var c=this;jQuery.each(jQuery("html").xmlns(),function(f,e){VIE2.namespaces[f]=e.toString();VIE2.globalCache.prefix(f,e)});try{jQuery.each(this.element.xmlns(),function(f,e){VIE2.namespaces[f]=e.toString();VIE2.globalCache.prefix(f,e)})}catch(d){if(this.element.get(0)!==document){VIE2.log("warn","VIE2.core#create()","Could not retrieve namespaces from element: '"+d+"'!")}}},analyze:function(f,c){if(!c){c={}}var e=this;if(f===b){VIE2.log("warn","VIE2.core#analyze()","No callback method specified!")}VIE2.log("info","VIE2.core#analyze()","Started.");var d=[];jQuery.each(VIE2.connectors,function(){if(c.connectors){if(c.connectors.indexOf(this.id)!==-1){d.push(this.id)}}else{d.push(this.id)}});jQuery.each(VIE2.connectors,function(){var g=function(i){return function(j){VIE2.log("info","VIE2.core#analyze()","Received RDF annotation from connector '"+this.id+"'!");jQuery.each(VIE2.namespaces,function(m,l){j.prefix(m,l)});j.databank.triples().each(function(){VIE2.globalCache.add(this)});jQuery.each(j.databank.subjectIndex,function(n,l){var k=n.toString();if(e.options.entities.indexOf(k)===-1){e.options.entities.push(k)}if(!VIE.EntityManager.getBySubject(k)){VIE2.log("info","VIE2.core#analyze()","Register new entity ("+k+")!");var m=new VIE2.Entity({id:k},{backend:true});VIE2.entities.add(m,{backend:true})}else{VIE.EntityManager.getBySubject(k).change()}});VIE2.Util.removeElement(d,this.id);if(d.length===0){VIE2.log("info","VIE2.core#analyze()","Finished! Global Cache holds now "+VIE2.globalCache.databank.triples().length+" triples!");VIE2.log("info","VIE2.core#analyze()","Finished! Local element holds now "+e.options.entities.length+" entities!");if(f){f.call(i)}}}}(e.element);var h=function(i){VIE2.log("error","VIE2.core#analyze()","Connector ("+this.id+") returned with the following error: '"+i+"'!");VIE2.Util.removeElement(d,this.id)};if(c.connectors){if(c.connectors.indexOf(this.id)!==-1){VIE2.log("info","VIE2.core#analyze()","Starting analysis with connector: '"+this.id+"'!");this.analyze(e.element,{success:g,error:h})}else{VIE2.log("info","VIE2.core#analyze()","Will not use connector "+this.id+" as it is filtered!")}}else{VIE2.log("info","VIE2.core#analyze()","Starting analysis with connector: '"+this.id+"'!");this.analyze(e.element,{success:g,error:h})}})},uris:function(){return this.options.entities},copy:function(c){var d=this;if(!c){VIE2.log("warn","VIE2.core#copy()","Invoked 'copy()' without target element!");return}VIE2.log("info","VIE2.core#copy()","Start.");VIE2.log("info","VIE2.core#copy()","Found "+this.options.entities.length+" entities for source.");a(c).vie2().vie2("option","entities",this.options.entities);VIE2.log("info","VIE2.core#copy()","Finished.");VIE2.log("info","VIE2.core#copy()","Target element has now "+a(c).vie2("option","entities")+" entities.");return this},clear:function(){this.options.entities={};return this}})}(jQuery));if(typeof VIE2=="undefined"||!VIE2){VIE2={}}VIE2.namespaces={};VIE2.globalCache=jQuery.rdf({namespaces:VIE2.namespaces});VIE2.clearCache=function(){VIE2.globalCache=jQuery.rdf({namespaces:VIE2.namespaces})};VIE2.getFromCache=function(c,d){var b=VIE2.ObjectCollection.extend({uri:c,property:d});var a=new b();VIE2.globalCache.where(jQuery.rdf.pattern(c,d,"?object",{namespaces:VIE2.namespaces})).each(function(){if(this.object.type){if(this.object.type==="literal"){var e=new VIE2.Literal({datatype:this.object.datatype,lang:this.object.lang,value:this.object.value,isLiteral:true,isResource:false});a.add(e,{backend:true,silent:true})}else{if(this.object.type==="uri"||this.object.type==="bnode"){if(VIE.EntityManager.getBySubject(this.object.toString())!==undefined){a.add(VIE.EntityManager.getBySubject(this.object.toString()),{backend:true,silent:true})}else{var e=new VIE2.Resource({value:this.object.value.toString(),isLiteral:false,isResource:true});a.add(e,{backend:true,silent:true})}}}}});return a};VIE2.lookup=function(e,d,f){VIE2.log("info","VIE2.lookup()","Start ('"+e+"', '"+d+"')!");if(e===undefined||typeof e!=="string"||d===undefined){VIE2.log("warn","VIE2.lookup()","Invoked 'lookup()' with wrong/undefined argument(s)!");if(f){f.call(e,a)}return}if(!jQuery.isArray(d)){VIE2.lookup(e,[d],f);return}var a={};for(var b=0;b<d.length;b++){a[d[b]]=[]}var c=[];jQuery.each(VIE2.connectors,function(){c.push(this.id)});jQuery.each(VIE2.connectors,function(){VIE2.log("info","VIE2.lookup()","Start with connector '"+this.id+"' for uri '"+e+"'!");var g=function(i,h,j){return function(k){VIE2.log("info","VIE2.lookup()","Received query information from connector '"+this.id+"' for uri '"+i+"'!");jQuery.each(k,function(m,l){for(var n=0;n<l.length;n++){var o=jQuery.rdf.triple(i,m,l[n],{namespaces:VIE2.namespaces});VIE2.globalCache.add(o)}});VIE2.Util.removeElement(c,this.id);if(c.length===0){jQuery.each(h,function(l){VIE2.globalCache.where(i+" "+l+" ?x").each(function(){var m=this.x.toString();if(h[l].indexOf(m)===-1){h[l].push(m)}})});VIE2.log("info","VIE2.lookup()","Finished task: 'query()' for uri '"+i+"'!");VIE2.log("info","VIE2.lookup()","Global Cache now holds "+VIE2.globalCache.databank.triples().length+" triples!");if(j){j.call(i,h)}}}}(e,a,f);this.query(e,d,g)})};VIE2.mappings={};VIE2.registerMapping=function(a){if(!VIE2.mappings[a.id]){var b=VIE2.EntityCollection.extend({model:VIE2.Entity});VIE2.mappings[a.id]={a:(jQuery.isArray(a.types))?a.types:[a.types],collection:new b(),mapping:a};VIE2.log("info","VIE2.registerMapping()","  Registered mapping '"+a.id+"'!")}else{VIE2.log("warn","VIE2.registerMapping()","Did not register mapping, as there isalready a mapping with the same id registered.")}};VIE2.unregisterMapping=function(a){VIE2.mappings[a]=undefined};VIE2.connectors={};VIE2.registerConnector=function(a){if(!VIE2.connectors[a.id]){VIE2.connectors[a.id]=a;if(a.options("namespaces")){jQuery.each(a.options("namespaces"),function(c,b){VIE2.namespaces[c]=b;VIE2.globalCache.prefix(c,b)})}VIE2.log("info","VIE2.registerConnector()","Registered connector '"+a.id+"'")}else{VIE2.log("warn","VIE2.registerConnector()","Did not register connector, as there isalready a connector with the same id registered.")}};VIE2.unregisterConnector=function(a){VIE2.connectors[connector.id]=undefined};VIE2.logLevels=["info","warn","error"];VIE2.log=function(c,a,b){if(VIE2.logLevels.indexOf(c)>-1){switch(c){case"info":console.info(a+" "+b);break;case"warn":console.warn(a+" "+b);break;case"error":console.error(a+" "+b);break}}};jQuery(document).vie2();